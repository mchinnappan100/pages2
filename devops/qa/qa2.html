<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Salesforce Metadata Deployment – Q & A</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0f172a;
    }
    .splitter {
      width: 6px;
      cursor: col-resize;
      background: linear-gradient(
        to bottom,
        #334155,
        #475569,
        #334155
      );
      transition: background 0.2s;
      flex-shrink: 0;
    }
    .splitter:hover {
      background: #64748b;
    }
    .nav-item.active {
      background-color: #1e293b;
      border-left: 4px solid #38bdf8;
    }
    .answer {
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="h-screen overflow-hidden text-slate-200 flex flex-col">
  <!-- Header -->
  <header class="px-6 py-4 border-b border-slate-700 bg-slate-900 z-10">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-semibold text-sky-400">
          Salesforce Metadata Deployment – Q & A
        </h1>
        <p class="text-sm text-slate-400 mt-1">
          Common deployment errors, root causes, and proven fixes
        </p>
      </div>
      <div class="hidden md:block">
        <span class="text-xs font-mono text-slate-500 bg-slate-800 px-2 py-1 rounded">v2.1 Updated</span>
      </div>
    </div>
  </header>

  <!-- Main Layout -->
  <div id="container" class="flex flex-1 overflow-hidden">
    <!-- Left Pane -->
    <aside id="leftPane" class="w-1/3 min-w-[300px] max-w-[600px] border-r border-slate-700 overflow-y-auto bg-slate-900/50">
      <ul class="divide-y divide-slate-800" id="navList">
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('staticFiles', this)">
          <h3 class="font-medium text-sky-300">Static files missing in zip</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('objectMissing', this)">
          <h3 class="font-medium text-sky-300">Object missing in directory</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('apiVersion', this)">
          <h3 class="font-medium text-sky-300">API version mismatch</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('profiles', this)">
          <h3 class="font-medium text-sky-300">Profile/Permission Set failures</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('destructive', this)">
          <h3 class="font-medium text-sky-300">Destructive changes ignored</h3>
        </li>
        <!-- New Items -->
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('missingDependencies', this)">
          <h3 class="font-medium text-sky-300">Missing Dependent Components</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('duplicateMetadata', this)">
          <h3 class="font-medium text-sky-300">Duplicate Metadata Entries</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('flowVersions', this)">
          <h3 class="font-medium text-sky-300">Flow Version Conflicts</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('validationRules', this)">
          <h3 class="font-medium text-sky-300">Validation Rule Syntax Errors</h3>
        </li>
        <li class="p-4 hover:bg-slate-800 cursor-pointer nav-item transition-colors" onclick="showAnswer('deploymentLock', this)">
          <h3 class="font-medium text-sky-300">Deployment Locks/Concurrency</h3>
        </li>
      </ul>
    </aside>

    <!-- Splitter -->
    <div id="splitter" class="splitter"></div>

    <!-- Right Pane -->
    <main id="rightPane" class="flex-1 p-8 overflow-y-auto bg-slate-900">
      <div id="content">
        <!-- Static Files -->
        <section id="staticFiles" class="answer hidden">
          <h2 class="text-2xl font-semibold text-emerald-400 mb-4">Static files missing in zip</h2>
          <p class="mb-4 text-slate-300">Metadata is declared in <code>package.xml</code> but the physical files are absent from the bundle.</p>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-slate-800 p-4 rounded-lg">
              <h3 class="font-semibold text-slate-100 mb-2">Root Causes</h3>
              <ul class="list-disc ml-5 text-sm text-slate-400 space-y-1">
                <li><code>.forceignore</code> excluding files</li>
                <li>Incorrect folder path (e.g., <code>staticresources</code> vs <code>staticresource</code>)</li>
                <li>Files were not pulled from source org</li>
              </ul>
            </div>
            <div class="bg-slate-800 p-4 rounded-lg">
              <h3 class="font-semibold text-slate-100 mb-2">Fix</h3>
              <ul class="list-disc ml-5 text-sm text-slate-400 space-y-1">
                <li>Verify <code>resource-meta.xml</code> presence</li>
                <li>Check file extension consistency</li>
                <li>Run <code>sf project retrieve start</code></li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Missing Dependencies -->
        <section id="missingDependencies" class="answer hidden">
          <h2 class="text-2xl font-semibold text-emerald-400 mb-4">Missing Dependent Components</h2>
          <p class="mb-4 text-slate-300 italic">Error: "Variable does not exist: [Field Name]" or "Component [Name] is missing."</p>
          <p class="mb-6 text-slate-300">Occurs when you deploy a component (like a Class or Layout) that references a field, label, or object not present in the target org or the current deployment.</p>
          <div class="bg-amber-900/20 border border-amber-600/50 p-4 rounded-lg mb-6">
            <h3 class="text-amber-400 font-bold mb-1">Standard Practice</h3>
            <p class="text-sm">Always include Custom Fields and Custom Labels referenced in Apex classes or Lightning Components in the same <code>package.xml</code>.</p>
          </div>
          <h3 class="font-semibold text-slate-100 mb-2">How to Fix</h3>
          <ul class="list-decimal ml-6 text-slate-300 space-y-2">
            <li>Review the deployment error log to identify the specific missing API name.</li>
            <li>Add the missing component to your <code>package.xml</code> or <code>destructiveChanges.xml</code>.</li>
            <li>If the component is from a Managed Package, ensure the package is installed in the target org.</li>
          </ul>
        </section>

        <!-- Duplicate Metadata -->
        <section id="duplicateMetadata" class="answer hidden">
          <h2 class="text-2xl font-semibold text-emerald-400 mb-4">Duplicate Metadata Entries</h2>
          <p class="mb-4 text-slate-300">Error: "Duplicate component in package.xml" or "Multiple entries for [Component]."</p>
          <div class="bg-slate-800 p-6 rounded-lg font-mono text-sm mb-4">
            <span class="text-red-400">&lt;types&gt;</span><br>
            &nbsp;&nbsp;<span class="text-sky-300">&lt;members&gt;MyClass&lt;/members&gt;</span><br>
            &nbsp;&nbsp;<span class="text-sky-300">&lt;members&gt;MyClass&lt;/members&gt;</span> <span class="text-red-500">&lt;-- ERROR</span><br>
            &nbsp;&nbsp;&lt;name&gt;ApexClass&lt;/name&gt;<br>
            <span class="text-red-400">&lt;/types&gt;</span>
          </div>
          <h3 class="font-semibold text-slate-100 mb-2">Resolution</h3>
          <p class="text-slate-300">Audit your <code>package.xml</code>. This often happens when automated script generation tools append instead of replacing members. Use a XML formatter or VS Code extensions to find duplicates.</p>
        </section>

        <!-- Flow Versions -->
        <section id="flowVersions" class="answer hidden">
          <h2 class="text-2xl font-semibold text-emerald-400 mb-4">Flow Version Conflicts</h2>
          <p class="mb-4 text-slate-300">Error: "Active flow version cannot be updated" or "Insufficient access to Flow."</p>
          <h3 class="font-semibold text-slate-100 mb-2">The Challenge</h3>
          <p class="text-slate-300 mb-4 text-sm leading-relaxed">Salesforce creates new versions of flows. If you try to deploy a flow that is already active in the target org, specific settings might block the overwrite depending on the metadata version.</p>
          <h3 class="font-semibold text-slate-100 mb-2">Strategy</h3>
          <ul class="list-disc ml-6 text-slate-300 space-y-1 text-sm">
            <li>Deploy the flow with <code>status: 'Draft'</code> if possible, then activate manually.</li>
            <li>Ensure the user performing deployment has "Manage Flow" permissions.</li>
            <li>Check if a specific version is being called by an active Process Builder or Trigger.</li>
          </ul>
        </section>

        <!-- Deployment Lock -->
        <section id="deploymentLock" class="answer hidden">
          <h2 class="text-2xl font-semibold text-emerald-400 mb-4">Deployment Locks/Concurrency</h2>
          <p class="mb-4 text-slate-300">Error: "The changes you requested are currently in progress..." or "Organization is locked."</p>
          <div class="bg-slate-800 p-4 rounded-lg mb-4">
            <p class="text-sm leading-relaxed">Salesforce Orgs allow only one metadata deployment or large-scale component change (like creating an index) at a time.</p>
          </div>
          <h3 class="font-semibold text-slate-100 mb-2">How to Fix</h3>
          <ul class="list-disc ml-6 text-slate-300">
            <li>Go to <strong>Setup > Deployment Status</strong> to see if another job is running.</li>
            <li>Cancel the existing job if it has stalled.</li>
            <li>Coordinate with team members to ensure CI/CD pipelines aren't overlapping.</li>
          </ul>
        </section>

        <!-- Validation Rules -->
        <section id="validationRules" class="answer hidden">
          <h2 class="text-2xl font-semibold text-emerald-400 mb-4">Validation Rule Syntax Errors</h2>
          <p class="mb-4 text-slate-300">Error: "Formula Expression is invalid."</p>
          <p class="text-slate-300 text-sm mb-4">Usually happens when a Validation Rule references a field that wasn't deployed yet or is named differently in the target org (case sensitivity in some scenarios).</p>
          <div class="bg-slate-800 p-4 rounded-lg">
            <h4 class="text-sky-300 font-bold mb-2">Checklist:</h4>
            <ul class="list-decimal ml-5 text-sm text-slate-400 space-y-1">
              <li>Are custom fields in the formula included in the deployment?</li>
              <li>Is there a typo in the API name (look for <code>__c</code> vs <code>__pc</code>)?</li>
              <li>Does the target org have the required feature enabled (e.g., Person Accounts)?</li>
            </ul>
          </div>
        </section>

        <!-- Keep Original Sections -->
        <section id="objectMissing" class="answer hidden">
            <h2 class="text-xl font-semibold text-emerald-400 mb-3">Object was named in package.xml but not found in directory</h2>
            <p class="text-slate-300">Verify the existence of <code>ObjectName.object-meta.xml</code> in the <code>objects/</code> folder.</p>
        </section>
        <section id="apiVersion" class="answer hidden">
            <h2 class="text-xl font-semibold text-emerald-400 mb-3">API version mismatch</h2>
            <p class="text-slate-300">Ensure the version in <code>package.xml</code> is equal to or lower than the Target Org version.</p>
        </section>
        <section id="profiles" class="answer hidden">
            <h2 class="text-xl font-semibold text-emerald-400 mb-3">Profile or Permission Set failures</h2>
            <p class="text-slate-300">Usually caused by referencing components (Fields/Classes) not included in the payload.</p>
        </section>
        <section id="destructive" class="answer hidden">
            <h2 class="text-xl font-semibold text-emerald-400 mb-3">Destructive changes not applied</h2>
            <p class="text-slate-300">Ensure <code>destructiveChanges.xml</code> is in the root and paired with a <code>package.xml</code>.</p>
        </section>

        <!-- Placeholder -->
        <div id="placeholder" class="flex flex-col items-center justify-center h-full text-slate-500 opacity-50">
          <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <p class="text-lg">Select a question to view the technical solution.</p>
        </div>
      </div>
    </main>
  </div>

  <script>
    const answers = document.querySelectorAll('.answer');
    const placeholder = document.getElementById('placeholder');
    const navItems = document.querySelectorAll('.nav-item');

    function showAnswer(id, element) {
      // Toggle visibility
      answers.forEach(a => a.classList.add('hidden'));
      placeholder.classList.add('hidden');
      
      const target = document.getElementById(id);
      if(target) {
        target.classList.remove('hidden');
      }

      // Handle active state
      navItems.forEach(item => item.classList.remove('active'));
      if(element) {
        element.classList.add('active');
      }

      // Scroll to top of right pane
      document.getElementById('rightPane').scrollTop = 0;
    }

    // Splitter logic
    const splitter = document.getElementById('splitter');
    const leftPane = document.getElementById('leftPane');

    let isDragging = false;

    splitter.addEventListener('mousedown', (e) => {
      isDragging = true;
      document.body.style.cursor = 'col-resize';
      document.body.style.userSelect = 'none';
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      const newWidth = e.clientX;
      if(newWidth > 260 && newWidth < 800) {
        leftPane.style.width = newWidth + 'px';
      }
    });

    window.addEventListener('mouseup', () => {
      isDragging = false;
      document.body.style.cursor = 'default';
      document.body.style.userSelect = 'auto';
    });
  </script>
</body>
</html>