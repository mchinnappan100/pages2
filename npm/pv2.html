<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NPM Package Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; }
    .splitter {
      width: 6px;
      background: transparent;
      cursor: col-resize;
      position: relative;
    }
    .splitter::after {
      content: '';
      position: absolute;
      left: 2px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #cbd5e1;
      transition: background 0.2s;
    }
    .splitter:hover::after {
      background: #3b82f6;
    }
    .dark .splitter::after { background: #4b5563; }
    .dark .splitter:hover::after { background: #60a5fa; }

    .category-header {
      @apply flex items-center justify-between px-4 py-3 font-medium text-gray-700 dark:text-gray-200 rounded-xl cursor-pointer select-none transition-colors duration-200;
    }
    .category-header:hover {
      @apply bg-gray-100 dark:bg-gray-700;
    }

    .tool-item {
      @apply flex items-start gap-3 px-4 py-3 rounded-xl cursor-pointer transition-all duration-200 group;
    }
    .tool-item:hover {
      @apply bg-gray-50 dark:bg-gray-700/70;
    }
    .tool-item.selected {
      @apply bg-blue-50 dark:bg-blue-900/40 ring-2 ring-blue-500/30;
    }
    .tool-item .tool-name {
      @apply font-medium text-sm text-gray-900 dark:text-gray-100 truncate;
    }
    .tool-item .tool-desc {
      @apply text-xs text-gray-500 dark:text-gray-400 line-clamp-2;
    }

    .markdown-body {
      @apply prose prose-lg dark:prose-invert max-w-4xl mx-auto;
    }
    .markdown-body pre {
      @apply relative bg-gray-900 dark:bg-gray-800/90 rounded-xl overflow-hidden shadow-lg my-6;
    }
    .markdown-body pre code {
      @apply block p-6 text-sm leading-relaxed;
    }
    .markdown-body code {
      @apply text-sm bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded-md;
    }
    .copy-btn {
      @apply absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white rounded-lg px-3 py-1.5 text-xs font-medium;
    }
    .copy-success {
      @apply bg-green-600;
    }

    .search-highlight {
      @apply bg-yellow-200 dark:bg-yellow-800/50 rounded px-1;
    }

    .chevron {
      @apply transition-transform duration-200;
    }
    .chevron.expanded {
      @apply rotate-90;
    }
  </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 flex flex-col">
  <!-- Header -->
  <header class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-800 px-6 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <svg class="w-9 h-9 text-red-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M0 0v24h24V0H0zm6.168 6.18h.8l3.564 5.95V6.18h.8v7.64h-.8l-3.564-5.95v5.95h-.8V6.18zm6.92 0h4.44v.72h-3.64v2.8h3.28v.72h-3.28v2.68h3.64v.72h-4.44V6.18z"/>
        </svg>
        <div>
          <h1 class="text-2xl font-bold">NPM Package Explorer</h1>
          <p class="text-sm text-gray-600 dark:text-gray-400">Discover and explore CLI tools & packages</p>
        </div>
      </div>
      <button id="themeToggle" class="p-2.5 rounded-xl bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition">
        <svg class="w-5 h-5 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
        </svg>
        <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- 3-Pane Layout -->
  <div id="splitContainer" class="flex-1 flex overflow-hidden">
    <!-- Left Pane -->
    <div id="leftPane" class="w-80 min-w-64 max-w-96 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col">
      <div class="p-5 border-b border-gray-200 dark:border-gray-800">
        <input
          type="text"
          id="searchInput"
          placeholder="Search packages..."
          class="w-full px-4 py-2.5 rounded-xl bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
        >
      </div>
      <div id="packageTree" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
    </div>

    <div id="splitter1" class="splitter"></div>

    <!-- Middle Pane: README -->
    <div id="middlePane" class="flex-1 bg-gray-50 dark:bg-gray-950 overflow-y-auto">
      <div id="readmeContent" class="min-h-full p-10">
        <div class="flex flex-col items-center justify-center h-full text-center text-gray-400">
          <svg class="w-20 h-20 mb-6 text-gray-300 dark:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <p class="text-xl font-medium">Select a package to view its README</p>
          <p class="text-sm mt-2 opacity-80">Browse the list on the left</p>
        </div>
      </div>
    </div>

    <div id="splitter2" class="splitter"></div>

    <!-- Right Pane -->
    <div id="rightPane" class="w-80 min-w-64 bg-white dark:bg-gray-900 overflow-y-auto">
      <div id="installInfo" class="p-8">
        <div class="flex flex-col items-center justify-center h-full text-center text-gray-400">
          <svg class="w-20 h-20 mb-6 text-gray-300 dark:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <p class="text-xl font-medium">Package Information</p>
          <p class="text-sm mt-2 opacity-80">Details will appear here</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Theme toggle
    const html = document.documentElement;
    if (localStorage.theme === 'dark' || (!localStorage.theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      html.classList.add('dark');
    }
    document.getElementById('themeToggle').addEventListener('click', () => {
      html.classList.toggle('dark');
      localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
    });

    // Splitter logic (same as before, slightly cleaned)
    function initSplitters() {
      const container = document.getElementById('splitContainer');
      const left = document.getElementById('leftPane');
      const middle = document.getElementById('middlePane');
      const right = document.getElementById('rightPane');
      let resizing = null;

      document.querySelectorAll('.splitter').forEach((splitter, i) => {
        splitter.addEventListener('mousedown', e => {
          resizing = i + 1;
          document.body.style.cursor = 'col-resize';
          e.preventDefault();
        });
      });

      document.addEventListener('mousemove', e => {
        if (!resizing) return;
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const total = rect.width;

        if (resizing === 1) {
          const leftW = Math.max(256, Math.min(x, total * 0.4));
          left.style.width = `${(leftW / total) * 100}%`;
        } else if (resizing === 2) {
          const leftW = parseFloat(getComputedStyle(left).width.replace('%', '')) / 100 * total;
          const middleW = Math.max(400, Math.min(x - leftW, total - leftW - 256));
          middle.style.width = `${(middleW / total) * 100}%`;
        }
      });

      document.addEventListener('mouseup', () => {
        if (resizing) {
          resizing = null;
          document.body.style.cursor = 'default';
        }
      });
    }
    initSplitters();

    // Data loading (unchanged)
    let packagesData = [];
    let selectedTool = null;

    async function loadPackagesData() {
      const params = new URLSearchParams(window.location.search);
      const dataUrl = params.get('d');
      if (dataUrl) {
        try {
          const res = await fetch(dataUrl);
          packagesData = await res.json();
        } catch (e) {
          packagesData = getDefaultData();
        }
      } else {
        packagesData = getDefaultData();
      }
      renderPackageTree();
    }


       function getDefaultData() {
      return [
        {
          "category": "AI & Analysis",
          "tools": [
            {
              "name": "mc-whisper-ui",
              "description": "CLI to transcribe video with Whisper and show a Tailwind + Monaco UI",
              "url": "https://www.npmjs.com/package/mc-whisper-ui"
            },
            {
              "name": "lwc-generator-cli",
              "description": "AI-powered Lightning Web Component generator with interactive web UI",
              "url": "https://www.npmjs.com/package/lwc-generator-cli"
            }
          ]
        },
        {
          "category": "Data Tools",
          "tools": [
            {
              "name": "datagen-cli",
              "description": "Generate realistic fake data from a simple JSON/JSON5 spec",
              "url": "https://www.npmjs.com/package/datagen-cli"
            },
            {
              "name": "csv-to-json-cli",
              "description": "High-performance CSV to JSON conversion utility",
              "url": "https://www.npmjs.com/package/csv-to-json-cli"
            }
          ]
        }
      ];
    }
    

    // Highlight search matches
    function highlightText(text, query) {
      if (!query) return text;
      const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    function renderPackageTree(filter = '') {
      const container = document.getElementById('packageTree');
      container.innerHTML = '';

      packagesData.forEach((cat, i) => {
        const matches = cat.tools.filter(t =>
          t.name.toLowerCase().includes(filter.toLowerCase()) ||
          t.description.toLowerCase().includes(filter.toLowerCase())
        );

        if (matches.length === 0 && filter) return;

        const isSearching = filter.length > 0;

        const catEl = document.createElement('div');
        catEl.className = 'space-y-2';

        const header = document.createElement('div');
        header.className = 'category-header';
        header.innerHTML = `
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 chevron ${isSearching ? 'expanded' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            <span>${cat.category}</span>
          </div>
          <span class="text-sm text-gray-500">${matches.length}</span>
        `;

        const toolsList = document.createElement('div');
        toolsList.className = `pl-8 space-y-1 ${isSearching ? '' : 'hidden'}`;

        matches.forEach(tool => {
          const item = document.createElement('div');
          item.className = 'tool-item group';
          item.innerHTML = `
            <svg class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
            </svg>
            <div class="flex-1 min-w-0">
              <div class="tool-name">${highlightText(tool.name, filter)}</div>
              <div class="tool-desc">${highlightText(tool.description, filter)}</div>
            </div>
          `;
          item.onclick = () => selectTool(tool, item);
          toolsList.appendChild(item);
        });

        header.onclick = () => {
          header.querySelector('.chevron').classList.toggle('expanded');
          toolsList.classList.toggle('hidden');
        };

        catEl.appendChild(header);
        catEl.appendChild(toolsList);
        container.appendChild(catEl);
      });
    }

    document.getElementById('searchInput').addEventListener('input', e => {
      renderPackageTree(e.target.value);
    });

    async function selectTool(tool, el) {
      document.querySelectorAll('.tool-item').forEach(i => i.classList.remove('selected'));
      el.classList.add('selected');
      selectedTool = tool;

      await loadReadme(tool);
      showInstallInfo(tool);
    }

    async function loadReadme(tool) {
      const container = document.getElementById('readmeContent');
      container.innerHTML = `<div class="flex justify-center py-20"><div class="animate-spin w-10 h-10 border-4 border-blue-500 rounded-full border-t-transparent"></div></div>`;

      try {
        const res = await fetch(`https://registry.npmjs.org/${tool.name}`);
        const data = await res.json();
        let readme = data.readme || '# No README available';

        let html = marked.parse(readme);
        html = html.replace(/<pre><code class="language-([\w-]+)">(.*?)<\/code><\/pre>/gs, (match, lang, code) => {
          const highlighted = hljs.highlight(code, { language: lang || 'plaintext' }).value;
          return `<pre class="group"><code>${highlighted}</code><button class="copy-btn" onclick="copyCode(this)">Copy</button></pre>`;
        });

        container.innerHTML = `<div class="markdown-body">${html}</div>`;
        hljs.highlightAll();
      } catch (err) {
        container.innerHTML = `<div class="text-center py-20 text-red-500">Failed to load README: ${err.message}</div>`;
      }
    }

    function showInstallInfo(tool) {
      const container = document.getElementById('installInfo');
      container.innerHTML = `
        <div class="space-y-8">
          <div>
            <h3 class="text-2xl font-bold mb-2">${tool.name}</h3>
            <p class="text-gray-600 dark:text-gray-400">${tool.description}</p>
          </div>

          <div>
            <h4 class="font-semibold mb-3 text-lg">Installation</h4>
            <div class="bg-gray-900 dark:bg-gray-800 rounded-xl p-5 flex items-center justify-between">
              <code class="text-green-400 font-mono">npm install -g ${tool.name}</code>
              <button onclick="copyToClipboard('npm install -g ${tool.name}')" class="text-gray-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="space-y-4">
            <h4 class="font-semibold text-lg">Package Managers</h4>
            ${['npm', 'yarn', 'pnpm'].map(pm => {
              const cmd = pm === 'npm' ? `npm install -g ${tool.name}` :
                         pm === 'yarn' ? `yarn global add ${tool.name}` :
                         `pnpm add -g ${tool.name}`;
              return `
                <div class="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4">
                  <div class="font-medium capitalize mb-1">${pm}</div>
                  <code class="text-xs text-gray-600 dark:text-gray-400">${cmd}</code>
                </div>`;
            }).join('')}
          </div>

          <div>
            <a href="${tool.url}" target="_blank" class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline font-medium">
              View on npm â†’ 
            </a>
          </div>
        </div>
      `;
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
      const toast = document.createElement('div');
      toast.textContent = 'Copied!';
      toast.className = 'fixed bottom-6 right-6 bg-green-600 text-white px-4 py-2 rounded-lg shadow-xl z-50';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    window.copyCode = function(btn) {
      const code = btn.previousElementSibling.textContent;
      navigator.clipboard.writeText(code);
      btn.textContent = 'Copied!';
      btn.classList.add('copy-success');
      setTimeout(() => {
        btn.textContent = 'Copy';
        btn.classList.remove('copy-success');
      }, 2000);
    };

    loadPackagesData();
  </script>
</body>
</html>