<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n5.github.io/dfv/img/mc_favIcon.ico"><title>Kids Drawing Studio - Slate</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Comic Sans MS',cursive,sans-serif;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);overflow:hidden;user-select:none}.app-container{display:flex;height:100vh;background:#fff;border-radius:20px;margin:10px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}.toolbar{width:80px;background:linear-gradient(180deg,#ff9a9e 0,#fecfef 50%,#fecfef 100%);display:flex;flex-direction:column;align-items:center;padding:20px 10px;gap:15px;box-shadow:2px 0 10px rgba(0,0,0,.1)}.tool-btn{width:50px;height:50px;border:none;border-radius:15px;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:24px;transition:all .3s ease;box-shadow:0 4px 8px rgba(0,0,0,.1)}.tool-btn:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.2)}.tool-btn.active{background:#4caf50;color:#fff;transform:scale(1.1)}.color-palette{width:250px;background:linear-gradient(180deg,#a8edea 0,#fed6e3 100%);padding:20px;display:flex;flex-direction:column;gap:20px}.palette-section{background:#fff;border-radius:15px;padding:15px;box-shadow:0 4px 8px rgba(0,0,0,.1)}.palette-title{font-size:16px;font-weight:700;color:#333;margin-bottom:10px;text-align:center}.colors-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}.color-btn{width:35px;height:35px;border:3px solid #fff;border-radius:50%;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px rgba(0,0,0,.2)}.color-btn:hover{transform:scale(1.1);border-color:#333}.color-btn.active{transform:scale(1.2);border-color:#333;box-shadow:0 0 0 2px #333}.brush-sizes{display:flex;justify-content:space-around;margin-top:10px}.size-btn{width:30px;height:30px;border:2px solid #ddd;border-radius:50%;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.size-btn:hover{border-color:#333}.size-btn.active{border-color:#4caf50;background:#4caf50}.size-dot{background:#333;border-radius:50%}.canvas-container{flex:1;display:flex;flex-direction:column;background:#f5f5f5}.top-bar{height:60px;background:linear-gradient(90deg,#667eea 0,#764ba2 100%);display:flex;align-items:center;justify-content:space-between;padding:0 20px;color:#fff}.app-title{font-size:24px;font-weight:700}.file-controls{display:flex;gap:10px}.file-btn{padding:8px 16px;border:none;border-radius:8px;background:rgba(255,255,255,.2);color:#fff;cursor:pointer;font-weight:700;transition:all .2s ease}.file-btn:hover{background:rgba(255,255,255,.3);transform:translateY(-1px)}.zoom-controls{display:flex;gap:10px;align-items:center}.zoom-label{font-size:16px;font-weight:700}.canvas-area{flex:1;display:flex;align-items:center;justify-content:center;padding:20px;overflow:hidden}#drawingCanvas{border:5px solid #fff;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.1);width:100%;height:100%;cursor:crosshair;background:#fff}.hidden{display:none}.crayon-texture{filter:url(#crayon-filter)}.pencil-texture{filter:url(#pencil-filter)}.marker-texture{opacity:.8}.eraser-cursor{cursor:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="20" height="20" fill="pink" stroke="black" stroke-width="2" rx="3"/></svg>') 10 10,auto}.hand-cursor{cursor:grab}.hand-cursor:active{cursor:grabbing}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}.tool-btn:active{animation:bounce .3s ease}</style></head><body><div class="app-container"><div class="toolbar"><button class="tool-btn active" data-tool="brush" title="Brush">🖌️</button> <button class="tool-btn" data-tool="pencil" title="Pencil">✏️</button> <button class="tool-btn" data-tool="crayon" title="Crayon">🖍️</button> <button class="tool-btn" data-tool="marker" title="Marker">🖊️</button> <button class="tool-btn" data-tool="eraser" title="Eraser">🧹</button> <button class="tool-btn" data-tool="spray" title="Spray Paint">💨</button> <button class="tool-btn" data-tool="line" title="Line">📏</button> <button class="tool-btn" data-tool="rectangle" title="Rectangle">⬜</button> <button class="tool-btn" data-tool="circle" title="Circle">⭕</button> <button class="tool-btn" data-tool="star" title="Star">⭐</button> <button class="tool-btn" data-tool="heart" title="Heart">💖</button> <button class="tool-btn" data-tool="hand" title="Pan">✋</button> <button class="tool-btn" data-tool="clear" title="Clear All">🗑️</button> <button class="tool-btn" data-tool="undo" title="Undo">↩️</button> <button class="tool-btn" data-tool="redo" title="Redo">↪️</button></div><div class="color-palette"><div class="palette-section"><div class="palette-title">🎨 Colors</div><div class="colors-grid" id="colorGrid"></div></div><div class="palette-section"><div class="palette-title">🖌️ Brush Size</div><div class="brush-sizes"><button class="size-btn" data-size="2"><div class="size-dot" style="width:4px;height:4px"></div></button> <button class="size-btn active" data-size="8"><div class="size-dot" style="width:8px;height:8px"></div></button> <button class="size-btn" data-size="16"><div class="size-dot" style="width:12px;height:12px"></div></button></div></div></div><div class="canvas-container"><div class="top-bar"><div class="app-title">🎨 Kids Drawing Studio - Slate</div><div class="zoom-controls"><span class="zoom-label" id="zoomLevel">100%</span></div><div class="file-controls"><button class="file-btn" id="newBtn">📄 New</button> <button class="file-btn" id="uploadBtn">📁 Open</button> <button class="file-btn" id="downloadBtn">💾 Save</button></div></div><div class="canvas-area"><canvas id="drawingCanvas"></canvas></div></div></div><input type="file" id="fileInput" accept="image/*" class="hidden"> <svg class="hidden"><defs><filter id="crayon-filter"><feTurbulence baseFrequency="0.9" numOctaves="4" result="noise"/><feDisplacementMap in="SourceGraphic" in2="noise" scale="2"/></filter><filter id="pencil-filter"><feTurbulence baseFrequency="0.5" numOctaves="2" result="noise"/><feDisplacementMap in="SourceGraphic" in2="noise" scale="1"/></filter></defs></svg><script>class KidsDrawingApp{constructor(){this.canvas=document.getElementById("drawingCanvas"),this.ctx=this.canvas.getContext("2d"),this.isDrawing=!1,this.isPanning=!1,this.currentTool="brush",this.currentColor="#FF6B6B",this.currentSize=8,this.lastX=0,this.lastY=0,this.startX=0,this.startY=0,this.points=[],this.commandStack=[],this.redoStack=[],this.maxStackSize=50,this.offsetX=0,this.offsetY=0,this.scale=1,this.minScale=.1,this.maxScale=5,this.panStartX=0,this.panStartY=0,this.pinchStartDist=0,this.init()}init(){this.setupCanvasSize(),this.setupColors(),this.setupEventListeners(),this.setupCanvas(),this.saveCommand({type:"clear"}),window.addEventListener("resize",(()=>this.setupCanvasSize())),this.updateZoomLabel()}setupCanvasSize(){const t=this.canvas.parentElement;this.canvas.width=t.clientWidth-40,this.canvas.height=t.clientHeight-40,this.redrawCanvas()}setupColors(){const t=document.getElementById("colorGrid");["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#85C1E9","#F4D03F","#A569BD","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#000000","#FFFFFF","#808080"].forEach(((s,e)=>{const i=document.createElement("button");i.className="color-btn",i.style.backgroundColor=s,i.addEventListener("click",(()=>this.selectColor(s,i))),t.appendChild(i),0===e&&i.classList.add("active")}))}setupEventListeners(){document.querySelectorAll(".tool-btn").forEach((t=>{t.addEventListener("click",(s=>{const e=s.target.dataset.tool;"clear"===e?this.clearCanvas():"undo"===e?this.undo():"redo"===e?this.redo():"zoom-in"===e?this.zoom(1.2):"zoom-out"===e?this.zoom(.8):this.selectTool(e,t)}))})),document.querySelectorAll(".size-btn").forEach((t=>{t.addEventListener("click",(s=>{this.selectSize(parseInt(s.target.dataset.size),t)}))})),this.canvas.addEventListener("mousedown",(t=>{"hand"===this.currentTool&&0===t.button?this.startPanning(t):0===t.button&&this.startDrawing(t)})),this.canvas.addEventListener("mousemove",(t=>{this.isPanning?this.pan(t):this.isDrawing&&this.draw(t)})),this.canvas.addEventListener("mouseup",(()=>{this.isPanning?this.stopPanning():this.isDrawing&&this.stopDrawing()})),this.canvas.addEventListener("mouseout",(()=>{this.stopPanning(),this.stopDrawing()})),this.canvas.addEventListener("wheel",(t=>{t.preventDefault();const s=t.deltaY<0?1.1:.9;this.zoom(s,t.clientX,t.clientY)})),this.canvas.addEventListener("touchstart",(t=>{if(t.preventDefault(),1===t.touches.length&&"hand"===this.currentTool){const s=t.touches[0],e=new MouseEvent("mousedown",{clientX:s.clientX,clientY:s.clientY,button:0});this.canvas.dispatchEvent(e)}else if(1===t.touches.length){const s=t.touches[0],e=new MouseEvent("mousedown",{clientX:s.clientX,clientY:s.clientY,button:0});this.canvas.dispatchEvent(e)}else 2===t.touches.length&&this.startPinch(t)})),this.canvas.addEventListener("touchmove",(t=>{if(t.preventDefault(),1===t.touches.length){const s=t.touches[0],e=new MouseEvent("mousemove",{clientX:s.clientX,clientY:s.clientY});this.canvas.dispatchEvent(e)}else 2===t.touches.length&&this.pinch(t)})),this.canvas.addEventListener("touchend",(t=>{if(t.preventDefault(),0===t.touches.length){const t=new MouseEvent("mouseup",{});this.canvas.dispatchEvent(t)}this.stopPinch()})),document.getElementById("newBtn").addEventListener("click",(()=>this.clearCanvas())),document.getElementById("uploadBtn").addEventListener("click",(()=>this.uploadImage())),document.getElementById("fileInput").addEventListener("change",(t=>this.loadImage(t))),document.getElementById("downloadBtn").addEventListener("click",(()=>this.downloadImage()))}setupCanvas(){this.ctx.lineCap="round",this.ctx.lineJoin="round",this.redrawCanvas()}selectTool(t,s){document.querySelectorAll(".tool-btn").forEach((t=>t.classList.remove("active"))),s.classList.add("active"),this.currentTool=t,this.canvas.classList.toggle("eraser-cursor","eraser"===t),this.canvas.classList.toggle("hand-cursor","hand"===t),this.canvas.style.cursor="eraser"===t?"auto":"hand"===t?"grab":"crosshair"}selectColor(t,s){document.querySelectorAll(".color-btn").forEach((t=>t.classList.remove("active"))),s.classList.add("active"),this.currentColor=t}selectSize(t,s){this.currentSize=Number(t),document.querySelectorAll(".size-btn").forEach((t=>t.classList.remove("active"))),s.classList.add("active"),this.redrawCanvas()}toVirtualCoordinates(t,s){return{x:(t-this.offsetX)/this.scale,y:(s-this.offsetY)/this.scale}}toScreenCoordinates(t,s){return{x:t*this.scale+this.offsetX,y:s*this.scale+this.offsetY}}getMousePos(t){const s=this.canvas.getBoundingClientRect(),e=t.clientX-s.left,i=t.clientY-s.top;return this.toVirtualCoordinates(e,i)}saveCommand(t){this.commandStack.length>=this.maxStackSize&&this.commandStack.shift(),this.commandStack.push(t),this.redoStack=[],this.redrawCanvas()}redrawCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale),this.commandStack.forEach((t=>{this.executeCommand(t)})),this.ctx.restore()}executeCommand(t){switch(this.ctx.globalCompositeOperation="eraser"===t.type?"destination-out":"source-over",this.ctx.strokeStyle=t.color||this.currentColor,this.ctx.fillStyle=t.color||this.currentColor,this.ctx.lineWidth=(t.size||this.currentSize)/this.scale,t.type){case"clear":this.ctx.clearRect(-this.offsetX/this.scale,-this.offsetY/this.scale,this.canvas.width/this.scale,this.canvas.height/this.scale),this.ctx.fillStyle="white",this.ctx.fillRect(-this.offsetX/this.scale,-this.offsetY/this.scale,this.canvas.width/this.scale,this.canvas.height/this.scale);break;case"image":t.image&&this.ctx.drawImage(t.image,t.x,t.y,t.width,t.height);break;case"brush":case"pencil":case"crayon":case"marker":case"eraser":this.ctx.beginPath(),this.ctx.moveTo(t.points[0].x,t.points[0].y),t.points.forEach((s=>{if("crayon"===t.type){const t=2*(Math.random()-.5)/this.scale,e=2*(Math.random()-.5)/this.scale;this.ctx.lineTo(s.x+t,s.y+e)}else this.ctx.lineTo(s.x,s.y)})),"pencil"===t.type&&(this.ctx.globalAlpha=.8,this.ctx.lineWidth=Math.min(t.size,1)/this.scale),"crayon"===t.type&&(this.ctx.globalAlpha=.7),"marker"===t.type&&(this.ctx.globalAlpha=.6),"eraser"===t.type&&(this.ctx.lineWidth=t.size/this.scale),this.ctx.stroke(),this.ctx.globalAlpha=1;break;case"spray":t.points.forEach((s=>{const e=t.size/this.scale;for(let t=0;t<20;t++){const t=(Math.random()-.5)*e,i=(Math.random()-.5)*e;this.ctx.globalAlpha=.5*Math.random()+.1,this.ctx.fillRect(s.x+t,s.y+i,1/this.scale,1/this.scale)}})),this.ctx.globalAlpha=1;break;case"line":this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(t.endX,t.endY),this.ctx.stroke();break;case"rectangle":this.ctx.strokeRect(t.startX,t.startY,t.width,t.height);break;case"circle":this.ctx.beginPath(),this.ctx.arc(t.centerX,t.centerY,t.radius,0,2*Math.PI),this.ctx.stroke();break;case"star":this.drawStar(t.centerX,t.centerY,5,20/this.scale,10/this.scale);break;case"heart":this.drawHeart(t.centerX,t.centerY,20/this.scale)}}undo(){if(this.commandStack.length>0){const t=this.commandStack.pop();this.redoStack.push(t),this.redrawCanvas()}}redo(){if(this.redoStack.length>0){const t=this.redoStack.pop();this.commandStack.push(t),this.redrawCanvas()}}startDrawing(t){this.isDrawing=!0;const s=this.getMousePos(t);this.lastX=s.x,this.lastY=s.y,this.startX=s.x,this.startY=s.y,this.points=[{x:s.x,y:s.y}]}draw(t){if(!this.isDrawing)return;const s=this.getMousePos(t);this.toScreenCoordinates(this.lastX,this.lastY),this.toScreenCoordinates(s.x,s.y);switch(this.ctx.globalCompositeOperation="eraser"===this.currentTool?"destination-out":"source-over",this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale),this.currentTool){case"brush":this.drawBrush(s);break;case"pencil":this.drawPencil(s);break;case"crayon":this.drawCrayon(s);break;case"marker":this.drawMarker(s);break;case"eraser":this.drawEraser(s);break;case"spray":this.drawSpray(s)}this.ctx.restore(),["brush","pencil","crayon","marker","eraser","spray"].includes(this.currentTool)&&this.points.push({x:s.x,y:s.y}),this.lastX=s.x,this.lastY=s.y}stopDrawing(){this.isDrawing&&(this.isDrawing=!1,["brush","pencil","crayon","marker","eraser","spray"].includes(this.currentTool)?this.saveCommand({type:this.currentTool,points:this.points,color:this.currentColor,size:this.currentSize}):["line","rectangle","circle","star","heart"].includes(this.currentTool)&&this.drawShape())}drawBrush(t){this.ctx.strokeStyle=this.currentColor,this.ctx.lineWidth=this.currentSize/this.scale,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}drawPencil(t){this.ctx.strokeStyle=this.currentColor,this.ctx.lineWidth=Math.min(this.currentSize,1)/this.scale,this.ctx.globalAlpha=.8,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(t.x,t.y),this.ctx.stroke(),this.ctx.globalAlpha=1}drawCrayon(t){this.ctx.strokeStyle=this.currentColor,this.ctx.lineWidth=this.currentSize/this.scale,this.ctx.globalAlpha=.7;const s=2*(Math.random()-.5)/this.scale,e=2*(Math.random()-.5)/this.scale;this.ctx.beginPath(),this.ctx.moveTo(this.lastX+s,this.lastY+e),this.ctx.lineTo(t.x+s,t.y+e),this.ctx.stroke(),this.ctx.globalAlpha=1}drawMarker(t){this.ctx.strokeStyle=this.currentColor,this.ctx.lineWidth=this.currentSize/this.scale,this.ctx.globalAlpha=.6,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(t.x,t.y),this.ctx.stroke(),this.ctx.globalAlpha=1}drawEraser(t){this.ctx.lineWidth=this.currentSize/this.scale,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}drawSpray(t){const s=this.currentSize/this.scale;for(let e=0;e<20;e++){const e=(Math.random()-.5)*s,i=(Math.random()-.5)*s;this.ctx.fillStyle=this.currentColor,this.ctx.globalAlpha=.5*Math.random()+.1,this.ctx.fillRect(t.x+e,t.y+i,1/this.scale,1/this.scale)}this.ctx.globalAlpha=1}drawShape(){this.ctx.save(),this.ctx.translate(this.offsetX,this.offsetY),this.ctx.scale(this.scale,this.scale),this.ctx.strokeStyle=this.currentColor,this.ctx.fillStyle=this.currentColor,this.ctx.lineWidth=this.currentSize/this.scale;const t={x:this.lastX,y:this.lastY};let s={color:this.currentColor,size:this.currentSize};switch(this.currentTool){case"line":this.ctx.beginPath(),this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(t.x,t.y),this.ctx.stroke(),s={...s,type:"line",startX:this.startX,startY:this.startY,endX:t.x,endY:t.y};break;case"rectangle":this.ctx.strokeRect(this.startX,this.startY,t.x-this.startX,t.y-this.startY),s={...s,type:"rectangle",startX:this.startX,startY:this.startY,width:t.x-this.startX,height:t.y-this.startY};break;case"circle":const e=Math.sqrt(Math.pow(t.x-this.startX,2)+Math.pow(t.y-this.startY,2));this.ctx.beginPath(),this.ctx.arc(this.startX,this.startY,e,0,2*Math.PI),this.ctx.stroke(),s={...s,type:"circle",centerX:this.startX,centerY:this.startY,radius:e};break;case"star":this.drawStar(this.startX,this.startY,5,20/this.scale,10/this.scale),s={...s,type:"star",centerX:this.startX,centerY:this.startY};break;case"heart":this.drawHeart(this.startX,this.startY,20/this.scale),s={...s,type:"heart",centerX:this.startX,centerY:this.startY}}this.ctx.restore(),this.saveCommand(s)}drawStar(t,s,e,i,a){let h=Math.PI/2*3,c=t,n=s;const r=Math.PI/e;this.ctx.beginPath(),this.ctx.moveTo(t,s-i);for(let o=0;o<e;o++)c=t+Math.cos(h)*i,n=s+Math.sin(h)*i,this.ctx.lineTo(c,n),h+=r,c=t+Math.cos(h)*a,n=s+Math.sin(h)*a,this.ctx.lineTo(c,n),h+=r;this.ctx.lineTo(t,s-i),this.ctx.closePath(),this.ctx.fill()}drawHeart(t,s,e){this.ctx.beginPath(),this.ctx.moveTo(t,s+e/4),this.ctx.bezierCurveTo(t,s,t-e/2,s,t-e/2,s+e/4),this.ctx.bezierCurveTo(t-e/2,s+e/2,t,s+e,t,s+e),this.ctx.bezierCurveTo(t,s+e,t+e/2,s+e/2,t+e/2,s+e/4),this.ctx.bezierCurveTo(t+e/2,s,t,s,t,s+e/4),this.ctx.fill()}startPanning(t){this.isPanning=!0;const s=this.canvas.getBoundingClientRect();this.panStartX=t.clientX-s.left,this.panStartY=t.clientY-s.top}pan(t){if(!this.isPanning)return;const s=this.canvas.getBoundingClientRect(),e=t.clientX-s.left,i=t.clientY-s.top;this.offsetX+=e-this.panStartX,this.offsetY+=i-this.panStartY,this.panStartX=e,this.panStartY=i,this.redrawCanvas()}stopPanning(){this.isPanning=!1}zoom(t,s,e){const i=this.scale;if(this.scale=Math.min(this.maxScale,Math.max(this.minScale,this.scale*t)),s&&e){const t=this.canvas.getBoundingClientRect(),a=s-t.left,h=e-t.top;this.offsetX=a-(a-this.offsetX)*(this.scale/i),this.offsetY=h-(h-this.offsetY)*(this.scale/i)}this.updateZoomLabel(),this.redrawCanvas()}startPinch(t){if(2===t.touches.length){const s=this.canvas.getBoundingClientRect(),e=t.touches[0],i=t.touches[1];this.pinchStartDist=Math.hypot(e.clientX-i.clientX,e.clientY-i.clientY),this.pinchStartX=(e.clientX+i.clientX)/2-s.left,this.pinchStartY=(e.clientY+i.clientY)/2-s.top}}pinch(t){if(2===t.touches.length){const s=t.touches[0],e=t.touches[1],i=Math.hypot(s.clientX-e.clientX,s.clientY-e.clientY),a=i/this.pinchStartDist;this.zoom(a,(s.clientX+e.clientX)/2,(s.clientY+e.clientY)/2),this.pinchStartDist=i}}stopPinch(){this.pinchStartDist=0}updateZoomLabel(){document.getElementById("zoomLevel").textContent=`${Math.round(100*this.scale)}%`}clearCanvas(){this.commandStack=[],this.redoStack=[],this.offsetX=0,this.offsetY=0,this.scale=1,this.updateZoomLabel(),this.saveCommand({type:"clear"})}uploadImage(){document.getElementById("fileInput").click()}loadImage(t){const s=t.target.files[0];if(!s)return;const e=new FileReader;e.onload=t=>{const s=new Image;s.onload=()=>{const t=this.canvas.width/this.scale,e=s.height/s.width*t;this.saveCommand({type:"image",image:s,x:0,y:0,width:t,height:e})},s.src=t.target.result},e.readAsDataURL(s)}downloadImage(){let t=1/0,s=1/0,e=-1/0,i=-1/0;this.commandStack.forEach((a=>{a.points?a.points.forEach((a=>{t=Math.min(t,a.x),s=Math.min(s,a.y),e=Math.max(e,a.x),i=Math.max(i,a.y)})):"image"===a.type?(t=Math.min(t,a.x),s=Math.min(s,a.y),e=Math.max(e,a.x+a.width),i=Math.max(i,a.y+a.height)):"clear"!==a.type&&(t=Math.min(t,a.startX||a.centerX||0),s=Math.min(s,a.startY||a.centerY||0),e=Math.max(e,(a.endX||a.centerX||0)+(a.width||0)),i=Math.max(i,(a.endY||a.centerY||0)+(a.height||0)))}));const a=Math.max(800,e-t+100),h=Math.max(600,i-s+100),c=document.createElement("canvas");c.width=a,c.height=h;const n=c.getContext("2d");n.fillStyle="white",n.fillRect(0,0,a,h),n.translate(50-t,50-s),this.commandStack.forEach((t=>{this.ctx=n,this.scale=1,this.offsetX=0,this.offsetY=0,this.executeCommand(t)})),this.ctx=this.canvas.getContext("2d"),this.redrawCanvas();const r=document.createElement("a");r.download=`kids-drawing-${Date.now()}.png`,r.href=c.toDataURL(),r.click()}}document.addEventListener("DOMContentLoaded",(()=>{new KidsDrawingApp}))</script></body></html>