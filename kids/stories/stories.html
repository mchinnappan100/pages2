<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒˆ Fun Stories for Kids</title>
  <link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n5.github.io/dfv/img/mc_favIcon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Fredoka:wght@400;600&display=swap');
    
    body {
      font-family: 'Fredoka', sans-serif;
    }
    
    .bubble {
      font-family: 'Bubblegum Sans', cursive;
    }
    
    .story-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .story-card:hover {
      transform: translateY(-8px) scale(1.02);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      animation: fadeIn 0.3s;
    }
    
    .modal.active {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .bounce {
      animation: bounce 2s infinite;
    }
    
    .star {
      animation: twinkle 1.5s infinite alternate;
    }
    
    @keyframes twinkle {
      from { opacity: 0.5; }
      to { opacity: 1; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 min-h-screen">
  
  <!-- Header -->
  <header class="bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 p-6 shadow-2xl">
    <div class="max-w-7xl mx-auto text-center">
      <h1 class="bubble text-5xl md:text-7xl text-white mb-2 drop-shadow-lg">
        ğŸŒˆ Story Time! ğŸ“š
      </h1>
      <p class="text-xl md:text-2xl text-white font-semibold">
        Fun Stories with Important Lessons âœ¨
      </p>
    </div>
  </header>

  <!-- Loading -->
  <div id="loading" class="text-center py-20">
    <div class="inline-block">
      <div class="w-20 h-20 border-8 border-pink-400 border-t-transparent rounded-full animate-spin"></div>
      <p class="mt-4 text-2xl text-purple-600 font-bold">Loading stories... ğŸ“–</p>
    </div>
  </div>

  <!-- Error Message -->
  <div id="error" class="hidden max-w-4xl mx-auto mt-10 p-8 bg-red-100 border-4 border-red-400 rounded-3xl">
    <p class="text-2xl text-red-600 font-bold text-center">ğŸ˜¢ Oops! Could not load stories.</p>
    <p class="text-lg text-red-500 text-center mt-2">Please make sure stories.json file exists!</p>
  </div>

  <!-- Stories Grid -->
  <main class="max-w-7xl mx-auto px-4 py-10">
    <div class="mb-8 text-center">
      <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur-sm px-6 py-3 rounded-full shadow-lg">
        <span class="text-2xl">ğŸ“š</span>
        <span class="text-xl font-bold text-purple-600" id="storyCount">0 Stories</span>
        <span class="text-2xl">âœ¨</span>
      </div>
    </div>
    
    <div id="storiesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Stories will be loaded here -->
    </div>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="bg-white rounded-3xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto shadow-2xl border-8 border-purple-400">
      <div class="sticky top-0 bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 p-6 rounded-t-2xl z-10">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <h2 id="modalTitle" class="bubble text-3xl md:text-4xl text-white mb-2">Story Title</h2>
            <div class="flex gap-2 flex-wrap">
              <span id="modalEmoji" class="text-4xl">ğŸ°</span>
              <span id="modalMoral" class="bg-white/30 backdrop-blur-sm text-white px-4 py-1 rounded-full text-sm font-semibold"></span>
            </div>
          </div>
          <button onclick="closeModal()" class="bg-white hover:bg-red-100 text-red-500 rounded-full w-12 h-12 flex items-center justify-center text-3xl font-bold transition-all hover:scale-110">
            Ã—
          </button>
        </div>
      </div>
      
      <div class="p-8">
        <!-- Read Aloud Button -->
        <div class="mb-6 flex gap-3 justify-center flex-wrap">
          <button onclick="readStory()" id="readBtn" class="bg-gradient-to-r from-green-400 to-teal-400 hover:from-green-500 hover:to-teal-500 text-white px-8 py-4 rounded-2xl font-bold text-xl transition-all transform hover:scale-105 shadow-lg flex items-center gap-3">
            <span class="text-3xl">ğŸ”Š</span>
            <span>Read Story Aloud</span>
          </button>
          <button onclick="pauseReading()" id="pauseBtn" class="hidden bg-gradient-to-r from-orange-400 to-red-400 hover:from-orange-500 hover:to-red-500 text-white px-8 py-4 rounded-2xl font-bold text-xl transition-all transform hover:scale-105 shadow-lg flex items-center gap-3">
            <span class="text-3xl">â¸ï¸</span>
            <span>Stop Reading</span>
          </button>
        </div>

        <!-- Voice Selection -->
        <div class="mb-6 bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
          <label class="block text-purple-700 font-bold mb-2">Choose Reading Voice:</label>
          <select id="voiceSelect" class="w-full p-3 rounded-lg border-2 border-purple-300 text-lg font-semibold bg-white">
            <option value="">Default Voice</option>
          </select>
          <div class="mt-2 flex gap-4 items-center">
            <label class="text-purple-700 font-semibold">Speed:</label>
            <input type="range" id="speedControl" min="0.5" max="1.5" step="0.1" value="0.9" class="flex-1">
            <span id="speedValue" class="text-purple-700 font-bold">0.9x</span>
          </div>
        </div>
        
        <div id="modalContent" class="text-gray-700 text-lg leading-relaxed space-y-4">
          <!-- Story content will be loaded here -->
        </div>
        
        <div class="mt-8 p-6 bg-gradient-to-r from-yellow-100 to-orange-100 rounded-2xl border-4 border-yellow-400">
          <p class="text-xl font-bold text-orange-600 mb-2">ğŸŒŸ What We Learn:</p>
          <p id="modalLesson" class="text-lg text-gray-700"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Elements -->
  <div class="fixed top-20 left-10 text-6xl bounce star hidden md:block">â­</div>
  <div class="fixed top-40 right-20 text-5xl bounce star hidden md:block" style="animation-delay: 0.5s">ğŸŒŸ</div>
  <div class="fixed bottom-20 left-20 text-6xl bounce star hidden md:block" style="animation-delay: 1s">âœ¨</div>
  <div class="fixed bottom-40 right-10 text-5xl bounce star hidden md:block" style="animation-delay: 1.5s">ğŸ’«</div>

  <script>
    let stories = [];
    let currentStoryIndex = 0;
    let speechSynthesis = window.speechSynthesis;
    let currentUtterance = null;
    let voices = [];
    
    const colors = [
      'from-red-400 to-pink-400',
      'from-orange-400 to-yellow-400',
      'from-green-400 to-teal-400',
      'from-blue-400 to-indigo-400',
      'from-purple-400 to-pink-400',
      'from-pink-400 to-rose-400'
    ];

    const borderColors = [
      'border-red-300',
      'border-orange-300',
      'border-green-300',
      'border-blue-300',
      'border-purple-300',
      'border-pink-300'
    ];

    // Load voices
    function loadVoices() {
      voices = speechSynthesis.getVoices();
      const voiceSelect = document.getElementById('voiceSelect');
      
      // Filter for English voices and child-friendly ones
      const englishVoices = voices.filter(voice => 
        voice.lang.startsWith('en') || voice.lang.includes('US') || voice.lang.includes('GB')
      );
      
      voiceSelect.innerHTML = '<option value="">Default Voice</option>';
      englishVoices.forEach((voice, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
    }

    // Load voices when available
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    // Update speed display
    document.getElementById('speedControl').addEventListener('input', (e) => {
      document.getElementById('speedValue').textContent = e.target.value + 'x';
    });

    // Get URL parameter
    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // Load stories from JSON
    async function loadStories() {
      const jsonFile = getUrlParameter('d') || 'stories.json';
      
      try {
        const response = await fetch(jsonFile);
        if (!response.ok) throw new Error('Failed to load stories');
        
        stories = await response.json();
        
        if (!Array.isArray(stories) || stories.length === 0) {
          throw new Error('Invalid stories format');
        }
        
        displayStories();
        document.getElementById('loading').classList.add('hidden');
      } catch (error) {
        console.error('Error loading stories:', error);
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
      }
    }

    // Display stories
    function displayStories() {
      const grid = document.getElementById('storiesGrid');
      document.getElementById('storyCount').textContent = `${stories.length} Stories`;
      
      grid.innerHTML = stories.map((story, index) => {
        const colorClass = colors[index % colors.length];
        const borderClass = borderColors[index % borderColors.length];
        
        return `
          <div class="story-card bg-white rounded-3xl shadow-xl overflow-hidden border-4 ${borderClass}" onclick="openStory(${index})">
            <div class="bg-gradient-to-br ${colorClass} p-6 text-center">
              <div class="text-7xl mb-2">${story.emoji || 'ğŸ“–'}</div>
              <h3 class="bubble text-2xl text-white font-bold drop-shadow-lg">${story.title}</h3>
            </div>
            <div class="p-6">
              <p class="text-gray-600 text-base mb-4 line-clamp-3">${story.story.substring(0, 120)}...</p>
              <div class="flex items-center justify-between">
                <span class="bg-purple-100 text-purple-600 px-4 py-2 rounded-full text-sm font-semibold">
                  ${story.moral}
                </span>
                <span class="text-3xl">ğŸ‘‰</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Read story aloud
    function readStory() {
      // Stop any current reading
      if (currentUtterance) {
        speechSynthesis.cancel();
      }

      const story = stories[currentStoryIndex];
      const fullText = `${story.title}. ${story.story}. What we learn: ${story.lesson}`;
      
      currentUtterance = new SpeechSynthesisUtterance(fullText);
      
      // Get selected voice
      const voiceSelect = document.getElementById('voiceSelect');
      const selectedVoiceIndex = voiceSelect.value;
      if (selectedVoiceIndex !== '') {
        const englishVoices = voices.filter(voice => 
          voice.lang.startsWith('en') || voice.lang.includes('US') || voice.lang.includes('GB')
        );
        currentUtterance.voice = englishVoices[selectedVoiceIndex];
      }
      
      // Set speech parameters
      currentUtterance.rate = parseFloat(document.getElementById('speedControl').value);
      currentUtterance.pitch = 1.2; // Slightly higher pitch for kids
      currentUtterance.volume = 1;
      
      // Update UI
      document.getElementById('readBtn').classList.add('hidden');
      document.getElementById('pauseBtn').classList.remove('hidden');
      
      // Handle end of speech
      currentUtterance.onend = () => {
        document.getElementById('readBtn').classList.remove('hidden');
        document.getElementById('pauseBtn').classList.add('hidden');
      };
      
      // Start reading
      speechSynthesis.speak(currentUtterance);
    }

    // Pause/Stop reading
    function pauseReading() {
      speechSynthesis.cancel();
      document.getElementById('readBtn').classList.remove('hidden');
      document.getElementById('pauseBtn').classList.add('hidden');
    }

    // Open story modal
    function openStory(index) {
      currentStoryIndex = index;
      const story = stories[index];
      const modal = document.getElementById('modal');
      
      // Stop any current reading
      pauseReading();
      
      document.getElementById('modalTitle').textContent = story.title;
      document.getElementById('modalEmoji').textContent = story.emoji || 'ğŸ“–';
      document.getElementById('modalMoral').textContent = story.moral;
      document.getElementById('modalLesson').textContent = story.lesson;
      
      // Format story content with paragraphs
      const paragraphs = story.story.split('\n\n').map(p => 
        `<p class="text-lg leading-relaxed">${p.trim()}</p>`
      ).join('');
      
      document.getElementById('modalContent').innerHTML = paragraphs;
      
      // Reset buttons
      document.getElementById('readBtn').classList.remove('hidden');
      document.getElementById('pauseBtn').classList.add('hidden');
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close modal
    function closeModal() {
      pauseReading();
      document.getElementById('modal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Close modal on background click
    document.getElementById('modal').addEventListener('click', (e) => {
      if (e.target.id === 'modal') {
        closeModal();
      }
    });

    // Close modal with ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // Load stories on page load
    loadStories();
  </script>

</body>
</html>
