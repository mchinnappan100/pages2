graph LR
    %% === Primary Flow ===
    A([ðŸ§‘â€ðŸ’» User Request]) --> B((ðŸ¤– LLM Agent))
    
    %% === Model Context Window ===
    subgraph MCW[ðŸ§  Model Context Window]
        B --> C[[ðŸ“¦ Tool Definitions - Loaded On Demand]]
        G --> H[[ðŸ“Š Final/Filtered Result - Minimal Data]]
    end
    
    B --> D[[ðŸ—‚ï¸ Explore Filesystem / Servers]]
    D --> C
    B --> E{{ðŸ§© Generated Code Snippet}}
    
    %% === Code Execution Environment ===
    subgraph CEE[ðŸ’» Code Execution Environment - CEE]
        E --> F([â–¶ï¸ Run Code: import gdrive...])
        F --> I[[ðŸ”§ Call callMCPTool - tool_id, ...]]
        I --> J([ðŸŒ MCP Server / External System])
        J --> K([ðŸ“¥ Return Full Data])
        K --> L([ðŸŒ€ Data Processing / Filtering / Loops in CEE])
        L --> G([ðŸª¶ Log / Return Filtered Result])
    end
    
    %% === Return Loop and Output ===
    H --> B
    B --> M{{ðŸ§¾ Final Context-Efficient Response}}

    %% === Styling ===
    %% Context Window
    style MCW fill:#eef7f3,stroke:#3c763d,stroke-width:1px
    style C fill:#d1f7c4,stroke:#3c763d,stroke-width:1px
    style H fill:#d1f7c4,stroke:#3c763d,stroke-width:1px

    %% Core LLM Agent
    style B fill:#cce5ff,stroke:#004085,stroke-width:2px,color:#001f3f,font-weight:bold

    %% Code Execution Environment
    style CEE fill:#fff9e6,stroke:#e69e00,stroke-width:1px
    style F fill:#ffe680,stroke:#e69e00,stroke-width:1px
    style I fill:#fff2cc,stroke:#b58900
    style L fill:#fff8dc,stroke:#c09000

    %% External Systems
    style J fill:#ffd6cc,stroke:#c0392b
    style K fill:#ffd6cc,stroke:#c0392b
    style D fill:#f9e6ff,stroke:#9932cc

    %% Final Output
    style M fill:#b3ffd9,stroke:#2e8b57,stroke-width:2px

    %% === Key Benefits Annotation ===
    subgraph KB[ðŸŒŸ Key Benefits]
        N[1ï¸âƒ£ Progressive Disclosure â€“ Load tools only when needed]
        O[2ï¸âƒ£ Context-Efficient Results â€“ Filter data outside LLM context]
        P[3ï¸âƒ£ Complex Control Flow â€“ Loops & conditionals in generated code]
    end

    %% Position key benefits visually aside (optional)
    M --> KB
