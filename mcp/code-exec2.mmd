graph LR
    %% === Primary Flow ===
    A([ğŸ§‘â€ğŸ’» User Request]) --> B((ğŸ¤– LLM Agent))
    
    %% === Model Context Window ===
    subgraph MCW[ğŸ§  Model Context Window]
        B --> C[[ğŸ“¦ Tool Definitions<br/>Loaded On Demand]]
        G --> H[[ğŸ“Š Final/Filtered Result<br/>Minimal Data]]
    end
    
    B --> D[[ğŸ—‚ï¸ Explore Filesystem /<br/>Servers]]
    D --> C
    B --> E{{ğŸ§© Generated Code<br/>Snippet}}
    
    %% === Code Execution Environment ===
    subgraph CEE[ğŸ’» Code Execution Environment - CEE]
        E --> F([â–¶ï¸ Run Code:<br/>import gdrive...])
        F --> I[[ğŸ”§ Call callMCPTool<br/>tool_id, ...]]
        I --> J([ğŸŒ MCP Server /<br/>External System])
        J --> K([ğŸ“¥ Return Full Data])
        K --> L([ğŸŒ€ Data Processing /<br/>Filtering / Loops in CEE])
        L --> G([ğŸª¶ Log / Return<br/>Filtered Result])
    end
    
    %% === Return Loop and Output ===
    H --> B
    B --> M{{ğŸ§¾ Final Context-<br/>Efficient Response}}
    
    %% === Key Benefits Annotation ===
    subgraph KB[ğŸŒŸ Key Benefits]
        N[1ï¸âƒ£ Progressive Disclosure<br/>Load tools only when needed]
        O[2ï¸âƒ£ Context-Efficient Results<br/>Filter data outside LLM context]
        P[3ï¸âƒ£ Complex Control Flow<br/>Loops & conditionals in generated code]
    end
    
    M --> KB
    
    %% === Enhanced Styling ===
    
    %% User Entry Point
    style A fill:#667eea,stroke:#4c51bf,stroke-width:3px,color:#fff,font-weight:bold
    
    %% Core LLM Agent - Purple gradient effect
    style B fill:#764ba2,stroke:#f093fb,stroke-width:4px,color:#fff,font-weight:bold
    
    %% Model Context Window - Cool blue tones
    style MCW fill:#e0f2fe,stroke:#0369a1,stroke-width:2px,color:#0c4a6e
    style C fill:#7dd3fc,stroke:#0284c7,stroke-width:2px,color:#0c4a6e
    style H fill:#7dd3fc,stroke:#0284c7,stroke-width:2px,color:#0c4a6e
    
    %% Filesystem/Servers - Purple accent
    style D fill:#e9d5ff,stroke:#9333ea,stroke-width:2px,color:#581c87
    
    %% Generated Code
    style E fill:#fbbf24,stroke:#d97706,stroke-width:2px,color:#78350f,font-weight:bold
    
    %% Code Execution Environment - Warm amber tones
    style CEE fill:#fef3c7,stroke:#f59e0b,stroke-width:2px,color:#78350f
    style F fill:#fcd34d,stroke:#f59e0b,stroke-width:2px,color:#78350f
    style I fill:#fde68a,stroke:#f59e0b,stroke-width:2px,color:#78350f
    style L fill:#fef08a,stroke:#eab308,stroke-width:2px,color:#713f12
    
    %% External Systems - Coral/Pink
    style J fill:#fda4af,stroke:#f43f5e,stroke-width:2px,color:#881337,font-weight:bold
    style K fill:#fda4af,stroke:#f43f5e,stroke-width:2px,color:#881337
    
    %% Return Result
    style G fill:#86efac,stroke:#22c55e,stroke-width:2px,color:#14532d
    
    %% Final Output - Success green
    style M fill:#4ade80,stroke:#16a34a,stroke-width:3px,color:#14532d,font-weight:bold
    
    %% Key Benefits Box - Gradient purple to blue
    style KB fill:#f3e8ff,stroke:#a855f7,stroke-width:2px,color:#581c87
    style N fill:#ddd6fe,stroke:#8b5cf6,stroke-width:1px,color:#4c1d95
    style O fill:#ddd6fe,stroke:#8b5cf6,stroke-width:1px,color:#4c1d95
    style P fill:#ddd6fe,stroke:#8b5cf6,stroke-width:1px,color:#4c1d95