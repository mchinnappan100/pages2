<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen Recorder Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
            position: relative;
        }

        .header {
            margin-bottom: 30px;
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .app-subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .meeting-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
            display: none;
        }

        .meeting-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .meeting-steps {
            text-align: left;
            color: #555;
            line-height: 1.6;
        }

        .recording-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .record-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .record-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.4);
        }

        .record-btn:active {
            transform: translateY(0);
        }

        .status-indicators {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 25px;
            font-size: 0.9rem;
            color: #666;
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .camera-icon {
            color: #4CAF50;
        }

        .mic-icon {
            color: #2196F3;
        }

        .help-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
        }

        .help-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-list {
            list-style: none;
            space-y: 10px;
        }

        .help-list li {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .code-snippet {
            background: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        .recording {
            background: linear-gradient(135deg, #28a745, #20c997) !important;
        }

        .recording::before {
            content: "ðŸ”´ ";
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .download-link {
            display: none;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .app-title {
                font-size: 2rem;
            }
            
            .recording-controls {
                flex-direction: column;
            }
            
            .status-indicators {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="app-title">ðŸ“¹ Screen Recorder Pro</h1>
            <p class="app-subtitle">High-quality screen recording with audio</p>
        </div>

        <div id="meeting-info" class="meeting-info">
            <div class="meeting-title" id="meeting-title">Meeting Title</div>
            <div class="meeting-steps" id="meeting-steps"></div>
        </div>

        <div class="recording-controls">
            <button type="button" class="record-btn" id="start">
                <svg class="icon" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" fill="currentColor"/>
                </svg>
                Start Recording
            </button>
        </div>

        <div class="status-indicators">
            <div class="status-item">
                <svg class="icon camera-icon" viewBox="0 0 24 24">
                    <path d="M23 7l-7 5 7 5V7z"/>
                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                </svg>
                Screen Capture
            </div>
            <div class="status-item">
                <svg class="icon mic-icon" viewBox="0 0 24 24">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                    <line x1="12" y1="19" x2="12" y2="23"/>
                    <line x1="8" y1="23" x2="16" y2="23"/>
                </svg>
                Audio Recording
            </div>
        </div>

        <div class="help-section">
            <div class="help-title">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                Quick Help
            </div>
            <ul class="help-list">
                <li>
                    <strong>Custom filename:</strong> Add <code>?f=myrecording</code> to the URL
                    <div class="code-snippet">example: recorder.html?f=project-demo</div>
                </li>
                <li>
                    <strong>Meeting title with steps:</strong> Use <code>?title=</code> parameter
                    <div class="code-snippet">example: ?title=PLM Demo; Easy steps to use PLM; Review features</div>
                </li>
                <li>
                    <strong>ðŸŽ§ Pro tip:</strong> Use headphones to avoid audio feedback and echo issues
                </li>
                <li>
                    <strong>macOS users:</strong> Grant screen recording permission in System Preferences > Security & Privacy > Privacy > Screen Recording
                </li>
            </ul>
        </div>

        <a id="download" class="download-link"></a>
    </div>

    <script>
        // Author: Mohan Chinnappan (Enhanced)
        // Aug 2021 - Updated 2025

        // Read query params
        const query = location.search.substr(1);
        var qresult = {};
        query.split("&").forEach(function(part) {
            const item = part.split("=");
            qresult[item[0]] = decodeURIComponent(item[1]);
        });

        // Handle filename parameter
        const defaultName = 'screenRecording';
        const outputFilename = (qresult.f || defaultName) + '.webm';

        // Handle title parameter
        if (qresult.title) {
            const meetingInfo = document.getElementById('meeting-info');
            const meetingTitle = document.getElementById('meeting-title');
            const meetingSteps = document.getElementById('meeting-steps');
            
            // Split by semicolon and create steps
            const parts = qresult.title.split(';');
            const title = parts[0].trim();
            const steps = parts.slice(1);
            
            meetingTitle.textContent = title;
            
            if (steps.length > 0) {
                const stepsList = steps.map((step, index) => 
                    `${index + 1}. ${step.trim()}`
                ).join('<br>');
                meetingSteps.innerHTML = `<strong>Steps:</strong><br>${stepsList}`;
            }
            
            meetingInfo.style.display = 'block';
        }

        // Download link
        const downloadLink = document.getElementById('download');

        // Media options
        const displayMediaOptions = {
            video: { cursor: "always" },
            audio: { echoCancellation: true, noiseSuppression: true, sampleRate: 44100 }
        };

        const mimeType = 'video/webm';
        let stream = null;
        let mediaRecorder = null;
        let isRecording = false;

        async function startCapture(displayMediaOptions) {
            const startButton = document.getElementById('start');
            
            if (isRecording) {
                // Stop recording
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
                return;
            }

            try {
                startButton.innerHTML = `
                    <svg class="icon" viewBox="0 0 24 24">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                    Recording...
                `;
                startButton.classList.add('recording', 'pulse');
                isRecording = true;

                // Get screen capture
                const stream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
                const [vtracks] = stream.getVideoTracks();

                // Get microphone audio
                const audioStream = await navigator.mediaDevices.getUserMedia({audio: true});
                const [atracks] = audioStream.getAudioTracks();

                const combinedStream = new MediaStream([vtracks, atracks]);

                // Handle track end events
                stream.getTracks().forEach((track) =>
                    track.addEventListener("ended", () => {
                        audioStream.getAudioTracks().forEach((audio) => audio.stop());
                        if (mediaRecorder) {
                            mediaRecorder.stop();
                        }
                        resetUI();
                    })
                );

                handleMediaRecording({stream: combinedStream, mimeType});

            } catch(err) {
                console.error("Error: " + err);
                alert(`Recording failed: ${err.message}\n\nPlease make sure you:\n- Allow screen sharing when prompted\n- Grant microphone access\n- Use a supported browser (Chrome, Firefox, Edge)`);
                resetUI();
            }
        }

        function resetUI() {
            const startButton = document.getElementById('start');
            startButton.innerHTML = `
                <svg class="icon" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" fill="currentColor"/>
                </svg>
                Start Recording
            `;
            startButton.classList.remove('recording', 'pulse');
            isRecording = false;
            mediaRecorder = null;
        }

        // Start button event
        const startButton = document.getElementById('start');
        startButton.addEventListener('click', e => {
            startCapture(displayMediaOptions);
        });

        const handleMediaRecording = ({stream, mimeType}) => {
            let recordedChunks = [];
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.start(200);

            mediaRecorder.ondataavailable = event => {
                if (event.data.size > 0) {
                    recordedChunks.push(event.data);
                }
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, {
                    type: mimeType
                });
                recordedChunks = [];
                
                const url = URL.createObjectURL(blob);
                downloadLink.href = url;
                downloadLink.download = outputFilename;
                downloadLink.click();

                window.URL.revokeObjectURL(url);
                
                // Show success message
                const container = document.querySelector('.container');
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 1000;
                    font-weight: 600;
                `;
                successMsg.textContent = `âœ… Recording saved as ${outputFilename}`;
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    successMsg.remove();
                }, 4000);

                resetUI();
            };
        };

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                startCapture(displayMediaOptions);
            }
            if (e.key === 'Escape' && isRecording) {
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
            }
        });
    </script>
</body>
</html>