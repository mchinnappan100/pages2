<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOQL Explain Plan Tool Setup on macOS</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n5.github.io/dfv/img/mc_favIcon.ico">
  <!-- Prism.js CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1;
    }
    html {
      scroll-behavior: smooth;
    }
    /* Style for the copy button */
    .copy-btn {
      transition: background-color 0.3s;
    }
    .copy-btn:hover {
      background-color: #2563eb !important;
    }
    /* Adjust Prism.js code block styling */
    pre[class*="language-"] {
      position: relative;
      background: #f5f2f0 !important;
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      font-size: 0.875rem;
    }
    code[class*="language-"] {
      background: none !important;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Sticky Navbar -->
  <nav class="bg-blue-600 text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="text-2xl font-bold">
        <a href="#home">SOQL Explain Plan Tool</a>
      </div>
      <div class="space-x-4">
        <a href="#home" class="hover:text-blue-200">Home</a>
        <a href="#overview" class="hover:text-blue-200">Overview</a>
        <a href="#setup" class="hover:text-blue-200">Setup Steps</a>
        <a href="#input" class="hover:text-blue-200">Input CSV</a>
        <a href="#running" class="hover:text-blue-200">Running</a>
        <a href="#output" class="hover:text-blue-200">Output</a>
        <a href="#troubleshooting" class="hover:text-blue-200">Troubleshooting</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main>
    <!-- Hero Section -->
    <section id="home" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-20">
      <div class="max-w-6xl mx-auto px-4 text-center">
        <h1 class="text-5xl font-bold mb-4">SOQL Explain Plan Tool Setup on macOS</h1>
        <p class="text-xl mb-8">A step-by-step guide to setting up and using the SOQLExplainPlan.py script on macOS for analyzing SOQL queries from Salesforce Apex classes.</p>
        <a href="#setup" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-200">Get Started</a>
      </div>
    </section>

    <!-- Overview Section -->
    <section id="overview" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 text-center mb-12">Overview</h2>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <p class="text-gray-600">The <code>SOQLExplainPlan.py</code> script retrieves explain plans for SOQL queries extracted from Salesforce Apex classes, using an input CSV generated by <code>ApexSOQLExtractor.py</code>. It authenticates with a Salesforce org via the Salesforce CLI, queries the REST API for explain plans, and produces a CSV and HTML report. This guide covers setup, usage, and troubleshooting on macOS.</p>
        </div>
      </div>
    </section>

    <!-- Setup Steps Section -->
    <section id="setup" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 mb-8">Setup Steps</h2>
        <p class="text-gray-600 mb-6">Follow these steps to set up the environment for <code>SOQLExplainPlan.py</code> on macOS:</p>
        <div class="space-y-6">
          <!-- Step 1: Install Homebrew -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Step 1: Install Homebrew</h3>
            <p class="text-gray-600 mb-4">Install Homebrew, a package manager for macOS, to manage dependencies:</p>
            <div class="relative">
              <pre class="language-bash"><code id="code-step1">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew --version</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-step1')">Copy</button>
            </div>
          </div>
          <!-- Step 2: Install Python -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Step 2: Install Python</h3>
            <p class="text-gray-600 mb-4">Install Python 3.9 or later using Homebrew:</p>
            <div class="relative">
              <pre class="language-bash"><code id="code-step2">brew install python
python3 --version
pip3 --version</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-step2')">Copy</button>
            </div>
          </div>
          <!-- Step 3: Install Salesforce CLI -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Step 3: Install Salesforce CLI</h3>
            <p class="text-gray-600 mb-4">Install the Salesforce CLI (<code>sf</code>) for org authentication:</p>
            <div class="relative">
              <pre class="language-bash"><code id="code-step3">brew install sf
sf --version</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-step3')">Copy</button>
            </div>
          </div>
          <!-- Step 4: Install Python Packages -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Step 4: Install Required Python Packages</h3>
            <p class="text-gray-600 mb-4">Install the <code>requests</code> library:</p>
            <div class="relative">
              <pre class="language-bash"><code id="code-step4">pip3 install requests
pip3 show requests</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-step4')">Copy</button>
            </div>
          </div>
          <!-- Step 5: Clone Repository -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Step 5: Clone the Repository</h3>
            <p class="text-gray-600 mb-4">Clone the <code>apex-utils</code> repository from GitHub:</p>
            <div class="relative">
              <pre class="language-bash"><code id="code-step5">brew install git
git clone https://github.com/mchinnappan100/apex-utils.git
cd apex-utils
ls</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-step5')">Copy</button>
            </div>
          </div>
          <!-- Step 6: Set Up Salesforce Org -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Step 6: Set Up Salesforce Org Authentication</h3>
            <p class="text-gray-600 mb-4">Authenticate with your Salesforce org using the Salesforce CLI:</p>
            <div class="relative">
              <pre class="language-bash"><code id="code-step6">sf force auth web login -u username
sf force org display -u username --json
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Input CSV Section -->
    <section id="input" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 mb-8">Input CSV File</h2>
        <p class="text-gray-600 mb-4">The input CSV file must be generated by <code>ApexSOQLExtractor.py</code>, which extracts SOQL, SOSL, and DML operations from Apex class files.</p>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">CSV Structure</h3>
          <table class="min-w-full bg-white border">
            <thead>
              <tr class="bg-gray-200">
                <th class="px-4 py-2 text-left">Column Name</th>
                <th class="px-4 py-2 text-left">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <td class="px-4 py-2">class_name</td>
                <td class="px-4 py-2">Name of the Apex class file (e.g., TestClass.cls).</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-2">start_linenumber</td>
                <td class="px-4 py-2">Line number where the SOQL query appears.</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-2">testClass</td>
                <td class="px-4 py-2">true if the class is a test class, false otherwise.</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-2">has_binding</td>
                <td class="px-4 py-2">true if the SOQL query contains bind variables, false otherwise.</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-2">soql_query</td>
                <td class="px-4 py-2">The extracted SOQL query (e.g., [SELECT Id FROM Account]).</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-2">sosl_query</td>
                <td class="px-4 py-2">Extracted SOSL queries, if any.</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-2">dml_operations</td>
                <td class="px-4 py-2">DML operations found in the file (e.g., insert, update).</td>
              </tr>
            </tbody>
          </table>
          <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">Generating the Input CSV</h3>
          <p class="text-gray-600 mb-4">Run <code>ApexSOQLExtractor.py</code> to generate the CSV:</p>
          <div class="relative">
            <pre class="language-bash"><code id="code-input-csv">mkdir apex_classes
# Add Apex class files to apex_classes, e.g., TestClass.cls
python3 ApexSOQLExtractor.py --folder-cls apex_classes --output-csv soql_queries.csv
cat soql_queries.csv</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-input-csv')">Copy</button>
          </div>
          <p class="text-gray-600 mt-4 mb-2">Example Apex class (<code>TestClass.cls</code>):</p>
          <div class="relative">
            <pre class="language-apex"><code id="code-apex">public class TestClass {
    public void query() {
        List<Account> accounts = [SELECT Id, Name FROM Account WHERE Industry = 'Tech'];
    }
}</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-apex')">Copy</button>
          </div>
          <p class="text-gray-600 mt-4">Expected CSV output:</p>
          <div class="relative">
            <pre class="language-csv"><code id="code-csv-output">class_name,start_linenumber,testClass,has_binding,soql_query,sosl_query,dml_operations
TestClass.cls,3,false,false,"[SELECT Id, Name FROM Account WHERE Industry = 'Tech']","",""</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-csv-output')">Copy</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Running the Script Section -->
    <section id="running" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 mb-8">Running the Script</h2>
        <p class="text-gray-600 mb-4">Execute <code>SOQLExplainPlan.py</code> with the input CSV and Salesforce credentials:</p>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="relative">
            <pre class="language-bash"><code id="code-run">cd apex-utils
python3 SOQLExplainPlan.py --input-soql-csv soql_queries.csv --username username --output-csv soql_with_explain.csv</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-run')">Copy</button>
          </div>
          <p class="text-gray-600 mt-4">Expected console output:</p>
          <div class="relative">
            <pre class="language-text"><code id="code-run-output">[INFO] Fetching Salesforce org authentication details...
[INFO] Processing SOQL explain plans...
[SUCCESS] CSV written to: soql_with_explain.csv
[SUCCESS] HTML written to: soql_with_explain.csv.html</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-run-output')">Copy</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Output Files Section -->
    <section id="output" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 mb-8">Output Files</h2>
        <p class="text-gray-600 mb-4">The script generates a CSV file and an HTML report:</p>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">CSV File</h3>
          <p class="text-gray-600 mb-4">The CSV (<code>soql_with_explain.csv</code>) includes input columns plus <code>modified_soql</code> and <code>explain_plan</code>:</p>
          <div class="relative">
            <pre class="language-csv"><code id="code-csv-result">class_name,start_linenumber,testClass,has_binding,soql_query,sosl_query,dml_operations,modified_soql,explain_plan
TestClass.cls,3,false,false,"[SELECT Id, Name FROM Account WHERE Industry = 'Tech']","","","SELECT Id, Name FROM Account WHERE Industry = 'Tech'","[{\"cardinality\": 1000, \"fields\": [], \"leadingOperationType\": \"TableScan\", \"relativeCost\": 0.5, ...}]"</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-csv-result')">Copy</button>
          </div>
          <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">HTML Report</h3>
          <p class="text-gray-600 mb-4">The HTML report (<code>soql_with_explain.csv.html</code>) displays results in a styled table. Open it in a browser:</p>
          <div class="relative">
            <pre class="language-bash"><code id="code-html-open">open soql_with_explain.csv.html</code></pre>
            <img src="img/query-explain-example.png" alt="HTML Report Screenshot" class="mt-4 mb-4 rounded-lg shadow-md">
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-html-open')">Copy</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Troubleshooting Section -->
    <section id="troubleshooting" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 mb-8">Troubleshooting</h2>
        <p class="text-gray-600 mb-4">Resolve common issues with these steps:</p>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Common Issues</h3>
          <ul class="list-disc list-inside text-gray-600 mb-4">
            <li><strong>Error: Failed to retrieve org credentials</strong>
              <ul class="list-circle list-inside ml-4">
                <li>Verify username: <code>sf force org display -u &lt;username&gt;</code></li>
                <li>Re-authenticate: <code>sf force login -u &lt;username&gt;</code></li>
                <li>Check API access in Salesforce Setup.</li>
              </ul>
            </li>
            <li><strong>Error: No such file or directory: 'soql_queries.csv'</strong>
              <ul class="list-circle list-inside ml-4">
                <li>Ensure CSV exists: <code>ls soql_queries.csv</code></li>
                <li>Run <code>ApexSOQLExtractor.py</code> to generate it.</li>
              </ul>
            </li>
            <li><strong>Error: HTTP 400/401 from Salesforce API</strong>
              <ul class="list-circle list-inside ml-4">
                <li>Check <code>modified_soql</code> for syntax errors.</li>
                <li>Refresh authentication: <code>sf force login -u &lt;username&gt;</code></li>
                <li>Verify API version (v60.0) in <code>SOQLExplainPlan.py</code>.</li>
              </ul>
            </li>
            <li><strong>Empty explain_plan Column</strong>
              <ul class="list-circle list-inside ml-4">
                <li>Queries from test classes or with bind variables are skipped.</li>
                <li>Check <code>testClass</code> and <code>has_binding</code> columns.</li>
              </ul>
            </li>
            <li><strong>HTML Report Not Rendering</strong>
              <ul class="list-circle list-inside ml-4">
                <li>Ensure internet access for Tailwind CSS CDN.</li>
                <li>Download Tailwind CSS locally and update the script.</li>
              </ul>
            </li>
          </ul>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Debugging Tips</h3>
          <p class="text-gray-600 mb-4">Add print statements in <code>SOQLExplainPlan.py</code> or test API calls manually:</p>
          <div class="relative">
            <pre class="language-bash"><code id="code-debug">curl -H "Authorization: Bearer &lt;access_token&gt;" "&lt;instance_url&gt;/services/data/v60.0/query/?explain=SELECT+Id+FROM+Account"</code></pre>
            <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-debug')">Copy</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-600 text-white py-6">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p>MC - 2025 SOQL Explain Plan Tool | <a href="https://github.com/mchinnappan100/apex-utils" class="underline hover:text-blue-200">GitHub Repository</a></p>
    </div>
  </footer>

  <!-- Prism.js JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csv.min.js"></script>
  <script>
    // Add Prism.js syntax highlighting for Apex
    Prism.languages.apex = Prism.languages.extend('clike', {
      'keyword': /\b(public|private|protected|static|final|abstract|global|with|without|sharing|class|void|return|if|else|for|while|trigger|interface)\b/,
      'string': {
        pattern: /'(?:\\[\s\S]|[^\\'])*'/,
        greedy: true
      },
      'operator': /[+\-*/%=&|!><]|\b(?:AND|OR|NOT|LIKE|IN)\b/,
      'punctuation': /[{}[\];(),.:]/
    });
  </script>

  <!-- JavaScript for Copy Functionality -->
  <script>
    function copyCode(elementId) {
      const codeElement = document.getElementById(elementId);
      const text = codeElement.innerText;
      navigator.clipboard.writeText(text).then(() => {
        alert('Code copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
  </script>
</body>
</html>