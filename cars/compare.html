<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Car Compare — Dark Theme</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Small custom tweaks */
    :root { color-scheme: dark; }
    .sticky-header { backdrop-filter: blur(6px); }
    .card { transition: transform .12s ease, box-shadow .12s ease; }
    .card:hover { transform: translateY(-4px); }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 antialiased min-h-screen flex flex-col">
  <!-- Header -->
  <header class="sticky top-0 z-30 sticky-header bg-gray-900/80 border-b border-gray-800 p-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 13l4 4L21 3" />
        </svg>
        <div>
          <h1 class="text-lg font-semibold">Car Compare</h1>
          <p class="text-sm text-gray-400">Add cars, fill specs, compare and download the results.</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <label for="search" class="sr-only">Search</label>
        <input id="search" type="search" placeholder="Search table..." class="bg-gray-800 text-gray-100 placeholder-gray-500 px-3 py-2 rounded-md w-64 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <button id="downloadCsv" class="px-3 py-2 rounded-md bg-indigo-600 hover:bg-indigo-500 text-white">Download CSV</button>
        <button id="downloadJson" class="px-3 py-2 rounded-md border border-gray-700 text-gray-200 hover:bg-gray-800">Download JSON</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 max-w-6xl mx-auto w-full p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left: add / quick list -->
    <section class="lg:col-span-1 space-y-4">
      <div class="bg-gray-800 border border-gray-700 p-4 rounded-2xl shadow-sm">
        <h2 class="font-semibold text-lg">Add a Car</h2>
        <p class="text-sm text-gray-400">Type a model (e.g. Honda Pilot) and press Add. Edit specs after adding.</p>
        <div class="mt-3 flex gap-2">
          <input id="carInput" type="text" placeholder="e.g. Tesla Model Y" class="flex-1 bg-gray-900 border border-gray-700 px-3 py-2 rounded-md focus:outline-none" />
          <button id="addCarBtn" class="px-4 py-2 bg-indigo-600 rounded-md hover:bg-indigo-500">Add</button>
        </div>
      </div>

      <div class="bg-gray-800 border border-gray-700 p-4 rounded-2xl h-[420px] overflow-auto">
        <h3 class="font-semibold">Cars</h3>
        <div id="carsList" class="mt-3 space-y-3"></div>
      </div>

      <div class="bg-gray-800 border border-gray-700 p-4 rounded-2xl">
        <h3 class="font-semibold">Compare Settings</h3>
        <p class="text-sm text-gray-400 mt-1">Choose metrics to show in the comparison table.</p>
        <div class="mt-3 grid grid-cols-2 gap-2 text-sm text-gray-300">
          <label class="flex items-center gap-2"><input type="checkbox" data-field="year" checked class="metricToggle"/> Year</label>
          <label class="flex items-center gap-2"><input type="checkbox" data-field="price" checked class="metricToggle"/> Price</label>
          <label class="flex items-center gap-2"><input type="checkbox" data-field="engine" checked class="metricToggle"/> Engine</label>
          <label class="flex items-center gap-2"><input type="checkbox" data-field="mpg" checked class="metricToggle"/> MPG</label>
          <label class="flex items-center gap-2"><input type="checkbox" data-field="range" class="metricToggle"/> Range</label>
          <label class="flex items-center gap-2"><input type="checkbox" data-field="notes" class="metricToggle"/> Notes</label>
        </div>
      </div>
    </section>

    <!-- Middle + Right: cards and table -->
    <section class="lg:col-span-2 space-y-4">
      <div class="bg-gray-800 border border-gray-700 p-4 rounded-2xl">
        <h2 class="font-semibold">Quick Cards</h2>
        <div id="cards" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>

      <div class="bg-gray-800 border border-gray-700 p-4 rounded-2xl">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">Comparison Table</h2>
          <div class="text-sm text-gray-400">Click headers to sort</div>
        </div>
        <div class="mt-4 overflow-x-auto">
          <table id="compareTable" class="w-full table-auto text-left border-collapse">
            <thead class="text-gray-300 text-sm">
              <tr id="tableHeadRow"></tr>
            </thead>
            <tbody id="tableBody" class="align-top text-sm"></tbody>
          </table>
        </div>

        <div class="mt-4 flex items-center justify-between">
          <div class="text-gray-400 text-sm">Showing <span id="rowCount">0</span> cars</div>
          <div class="flex items-center gap-2">
            <button id="prevPage" class="px-3 py-1 rounded-md border border-gray-700 text-sm">Prev</button>
            <div class="px-3 py-1 bg-gray-900 border border-gray-800 rounded-md text-sm" id="pageInfo">1</div>
            <button id="nextPage" class="px-3 py-1 rounded-md border border-gray-700 text-sm">Next</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="sticky bottom-0 bg-gray-900/80 border-t border-gray-800 p-4">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="text-sm text-gray-400">Built with ❤️ — Dark Tailwind demo</div>
      <div class="text-sm text-gray-400">Tip: click a car card to edit specs</div>
    </div>
  </footer>

  <!-- Edit Modal -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative bg-gray-900 border border-gray-800 rounded-2xl p-6 w-full max-w-2xl z-10">
      <h3 id="modalTitle" class="text-lg font-semibold">Edit Car</h3>
      <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
        <label class="flex flex-col text-sm">Model<input id="m_model" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"/></label>
        <label class="flex flex-col text-sm">Year<input id="m_year" type="number" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"/></label>
        <label class="flex flex-col text-sm">Price<input id="m_price" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"/></label>
        <label class="flex flex-col text-sm">Engine<input id="m_engine" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"/></label>
        <label class="flex flex-col text-sm">MPG<input id="m_mpg" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"/></label>
        <label class="flex flex-col text-sm">Range (mi)<input id="m_range" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"/></label>
        <label class="flex flex-col sm:col-span-2 text-sm">Notes<textarea id="m_notes" rows="3" class="mt-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-md"></textarea></label>
      </div>
      <div class="mt-4 flex items-center justify-end gap-2">
        <button id="deleteCar" class="px-4 py-2 rounded-md border border-red-700 text-red-400">Delete</button>
        <button id="closeModal" class="px-4 py-2 rounded-md border border-gray-700">Cancel</button>
        <button id="saveCar" class="px-4 py-2 rounded-md bg-indigo-600 text-white">Save</button>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * Simple in-memory store
     ***********************/
    let cars = []; // {id, model, year, price, engine, mpg, range, notes}
    let currentEditId = null;
    let sortState = { field: 'model', dir: 'asc' };
    let pageSize = 6, currentPage = 1;

    // DOM refs
    const carInput = document.getElementById('carInput');
    const addCarBtn = document.getElementById('addCarBtn');
    const carsList = document.getElementById('carsList');
    const cards = document.getElementById('cards');
    const tableHeadRow = document.getElementById('tableHeadRow');
    const tableBody = document.getElementById('tableBody');
    const search = document.getElementById('search');
    const rowCount = document.getElementById('rowCount');
    const downloadCsv = document.getElementById('downloadCsv');
    const downloadJson = document.getElementById('downloadJson');
    const prevPage = document.getElementById('prevPage');
    const nextPage = document.getElementById('nextPage');
    const pageInfo = document.getElementById('pageInfo');

    // modal refs
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const m_model = document.getElementById('m_model');
    const m_year = document.getElementById('m_year');
    const m_price = document.getElementById('m_price');
    const m_engine = document.getElementById('m_engine');
    const m_mpg = document.getElementById('m_mpg');
    const m_range = document.getElementById('m_range');
    const m_notes = document.getElementById('m_notes');
    const saveCar = document.getElementById('saveCar');
    const closeModal = document.getElementById('closeModal');
    const deleteCar = document.getElementById('deleteCar');

    // metrics toggles
    const metricToggles = Array.from(document.querySelectorAll('.metricToggle'));

    // helpers
    function uid() { return Math.random().toString(36).slice(2,9); }

    function createCar(model) {
      return { id: uid(), model: model.trim(), year:'', price:'', engine:'', mpg:'', range:'', notes:'' };
    }

    function saveAndRerender() { renderCarsList(); renderCards(); renderTable(); }

    // add
    addCarBtn.addEventListener('click', ()=>{
      const val = carInput.value.trim();
      if(!val) return;
      cars.push(createCar(val));
      carInput.value = '';
      currentPage = 1;
      saveAndRerender();
    });

    carInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ addCarBtn.click(); } });

    // render list on left
    function renderCarsList(){
      carsList.innerHTML = '';
      cars.forEach(c=>{
        const el = document.createElement('div');
        el.className = 'flex items-center justify-between gap-3 p-2 rounded-md bg-gray-900 border border-gray-800 card';
        el.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="text-sm">
              <div class="font-medium">${escapeHtml(c.model)}</div>
              <div class="text-xs text-gray-400">${c.year?escapeHtml(c.year):''} ${c.engine? ' • '+escapeHtml(c.engine):''}</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button class="px-2 py-1 text-sm rounded-md bg-gray-800 border border-gray-700 editBtn" data-id="${c.id}">Edit</button>
            <button class="px-2 py-1 text-sm rounded-md border border-red-700 text-red-400 delBtn" data-id="${c.id}">Delete</button>
          </div>
        `;
        carsList.appendChild(el);
      });
      // attach events
      Array.from(document.querySelectorAll('.editBtn')).forEach(b=> b.addEventListener('click', e=> openEditModal(e.target.dataset.id)));
      Array.from(document.querySelectorAll('.delBtn')).forEach(b=> b.addEventListener('click', e=> { deleteById(e.target.dataset.id); }));
    }

    // cards
    function renderCards(){
      cards.innerHTML = '';
      cars.forEach(c=>{
        const el = document.createElement('div');
        el.className = 'p-4 rounded-2xl border border-gray-800 card bg-gradient-to-b from-gray-900 to-gray-800 cursor-pointer';
        el.innerHTML = `
          <div class="flex items-start justify-between">
            <div>
              <div class="text-sm text-gray-400">${escapeHtml(c.year || '')}</div>
              <div class="font-semibold text-lg">${escapeHtml(c.model)}</div>
              <div class="text-sm text-gray-400 mt-2">${c.price?escapeHtml(c.price):'<span class="text-gray-600">Price</span>'}</div>
            </div>
            <div class="text-right text-sm">
              <div>${c.mpg?escapeHtml(c.mpg)+' MPG':''}</div>
              <div class="text-gray-400 text-xs">${c.engine?escapeHtml(c.engine):''}</div>
            </div>
          </div>
        `;
        el.addEventListener('click', ()=> openEditModal(c.id));
        cards.appendChild(el);
      });
    }

    // table rendering
    function getActiveFields(){
      const checked = metricToggles.filter(t=>t.checked).map(t=>t.dataset.field);
      // always include model
      if(!checked.includes('model')) checked.unshift('model');
      return checked;
    }

    function renderTable(){
      const fields = getActiveFields();
      // header
      tableHeadRow.innerHTML = '';
      fields.forEach(f=>{
        const th = document.createElement('th');
        th.className = 'px-3 py-2 cursor-pointer select-none';
        th.textContent = fieldTitle(f);
        th.dataset.field = f;
        th.addEventListener('click', ()=>{ toggleSort(f); });
        tableHeadRow.appendChild(th);
      });

      // filter + sort
      const q = search.value.trim().toLowerCase();
      let filtered = cars.filter(c=>{
        if(!q) return true;
        return Object.values(c).join(' ').toLowerCase().includes(q);
      });

      filtered.sort((a,b)=> compareBy(a,b, sortState.field, sortState.dir));

      rowCount.textContent = filtered.length;

      // pagination
      const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      if(currentPage > totalPages) currentPage = totalPages;
      const start = (currentPage-1)*pageSize;
      const pageSlice = filtered.slice(start, start+pageSize);

      pageInfo.textContent = `${currentPage} / ${totalPages}`;

      // body
      tableBody.innerHTML = '';
      pageSlice.forEach(c=>{
        const tr = document.createElement('tr');
        tr.className = 'border-t border-gray-800';
        fields.forEach(f=>{
          const td = document.createElement('td');
          td.className = 'px-3 py-2 align-top';
          td.innerHTML = formatField(c, f);
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });
    }

    function formatField(c,f){
      if(f==='price') return c.price?escapeHtml(c.price):'-';
      if(f==='mpg') return c.mpg?escapeHtml(c.mpg):'-';
      if(f==='range') return c.range?escapeHtml(c.range):'-';
      if(f==='notes') return c.notes ? `<div class="text-xs text-gray-300">${escapeHtml(c.notes)}</div>` : '-';
      if(f==='year') return c.year || '-';
      if(f==='engine') return c.engine || '-';
      if(f==='model') return `<div class="font-medium">${escapeHtml(c.model)}</div>`;
      return c[f] || '-';
    }

    function fieldTitle(f){
      return ({model:'Model', year:'Year', price:'Price', engine:'Engine', mpg:'MPG', range:'Range (mi)', notes:'Notes'})[f] || f;
    }

    function toggleSort(field){
      if(sortState.field===field) sortState.dir = sortState.dir==='asc'?'desc':'asc';
      else { sortState.field = field; sortState.dir='asc'; }
      renderTable();
    }

    function compareBy(a,b,field,dir){
      const va = (a[field]||'').toString().toLowerCase();
      const vb = (b[field]||'').toString().toLowerCase();
      // try numeric
      const na = parseFloat(va.replace(/[^0-9.\-]/g,''));
      const nb = parseFloat(vb.replace(/[^0-9.\-]/g,''));
      if(!isNaN(na) && !isNaN(nb)){
        return dir==='asc' ? na-nb : nb-na;
      }
      if(va<vb) return dir==='asc' ? -1 : 1;
      if(va>vb) return dir==='asc' ? 1 : -1;
      return 0;
    }

    // search
    search.addEventListener('input', ()=>{ currentPage=1; renderTable(); });

    // pagination
    prevPage.addEventListener('click', ()=>{ if(currentPage>1){ currentPage--; renderTable(); } });
    nextPage.addEventListener('click', ()=>{ currentPage++; renderTable(); });

    // modal functions
    function openEditModal(id){
      const c = cars.find(x=>x.id===id); if(!c) return;
      currentEditId = id;
      modalTitle.textContent = `Edit — ${c.model}`;
      m_model.value = c.model; m_year.value = c.year; m_price.value = c.price; m_engine.value = c.engine; m_mpg.value = c.mpg; m_range.value = c.range; m_notes.value = c.notes;
      modal.classList.remove('hidden'); modal.classList.add('flex');
    }
    closeModal.addEventListener('click', ()=>{ modal.classList.add('hidden'); modal.classList.remove('flex'); });

    saveCar.addEventListener('click', ()=>{
      const c = cars.find(x=>x.id===currentEditId); if(!c) return;
      c.model = m_model.value.trim(); c.year = m_year.value.trim(); c.price = m_price.value.trim(); c.engine = m_engine.value.trim(); c.mpg = m_mpg.value.trim(); c.range = m_range.value.trim(); c.notes = m_notes.value.trim();
      modal.classList.add('hidden'); modal.classList.remove('flex');
      saveAndRerender();
    });

    deleteCar.addEventListener('click', ()=>{
      if(!confirm('Delete this car?')) return;
      deleteById(currentEditId);
      modal.classList.add('hidden'); modal.classList.remove('flex');
    });

    function deleteById(id){ cars = cars.filter(x=>x.id!==id); saveAndRerender(); }

    // download
    downloadJson.addEventListener('click', ()=>{
      const data = JSON.stringify(cars, null, 2);
      downloadBlob(data, 'application/json', 'car-comparison.json');
    });
    downloadCsv.addEventListener('click', ()=>{
      const fields = ['model','year','price','engine','mpg','range','notes'];
      const rows = cars.map(c=> fields.map(f=> '"'+String((c[f]||'')).replace(/"/g,'""')+'"').join(','));
      const csv = [fields.join(','), ...rows].join('\n');
      downloadBlob(csv, 'text/csv', 'car-comparison.csv');
    });

    function downloadBlob(content, mime, filename){
      const blob = new Blob([content], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // small utility
    function escapeHtml(str){ return String(str).replace(/[&"'<>]/g, s=>({ '&':'&amp;','"':'&quot;','\'':'&#39;','<':'&lt;','>':'&gt;'}[s])); }

    // metric toggles
    metricToggles.forEach(t=> t.addEventListener('change', ()=> renderTable()));

    // initialize with a few sample cars
    cars = [
      { id: uid(), model: 'Honda Pilot', year: '2024', price: '$38,000', engine: '3.5L V6', mpg: '20/27', range:'', notes:'7 seats standard' },
      { id: uid(), model: 'Tesla Model Y', year: '2025', price: '$47,000', engine: 'Electric', mpg: '', range:'330', notes:'AWD option' },
      { id: uid(), model: 'Toyota RAV4', year: '2024', price: '$30,000', engine: '2.5L I4', mpg: '27/35', range:'', notes:'' }
    ];

    // initial render
    renderCarsList(); renderCards(); renderTable();

  </script>
</body>
</html>
