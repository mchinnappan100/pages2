<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Salesforce Development Best Practices</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n5.github.io/dfv/img/mc_favIcon.ico">
  <!-- Prism.js CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1;
    }
    html {
      scroll-behavior: smooth;
    }
    /* Style for the copy button */
    .copy-btn {
      transition: background-color 0.3s;
    }
    .copy-btn:hover {
      background-color: #2563eb !important;
    }
    /* Adjust Prism.js code block styling */
    pre[class*="language-"] {
      position: relative;
      background: #f5f2f0 !important;
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      font-size: 0.875rem;
    }
    code[class*="language-"] {
      background: none !important;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Sticky Navbar -->
  <nav class="bg-blue-600 text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="text-2xl font-bold">
        <a href="#home">Salesforce Best Practices</a>
      </div>
      <div class="space-x-4">
        <a href="#home" class="hover:text-blue-200">Home</a>
        <a href="#overview" class="hover:text-blue-200">Overview</a>
        <a href="#best-practices" class="hover:text-blue-200">Best Practices</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main>
    <!-- Hero Section -->
    <section id="home" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-20">
      <div class="max-w-6xl mx-auto px-4 text-center">
        <h1 class="text-5xl font-bold mb-4">Salesforce Development Best Practices</h1>
        <p class="text-xl mb-8">A concise guide to best practices for Salesforce development, focusing on Apex, permissions, and DevOps integration.</p>
        <a href="#best-practices" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-200">Get Started</a>
      </div>
    </section>

    <!-- Overview Section -->
    <section id="overview" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 text-center mb-12">Overview</h2>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <p class="text-gray-600">This guide provides best practices for Salesforce development to ensure clean, efficient, and maintainable code. It covers common pitfalls in Apex development, permission management, SOQL optimization, and unique ID generation, with a focus on integrating these checks into a DevOps pipeline for automated validation. Following these practices will help avoid runtime errors, deployment issues, and performance bottlenecks in your Salesforce org.</p>
        </div>
      </div>
    </section>

    <!-- Best Practices Section -->
    <section id="best-practices" class="py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-800 mb-8">Best Practices</h2>
        <p class="text-gray-600 mb-6">Follow these best practices to improve your Salesforce development process and integrate checks into your DevOps pipeline:</p>
        <div class="space-y-6">
          <!-- Practice 1: Use System.UUID for Unique IDs -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Use System.UUID for Unique IDs in Test Data Factory</h3>
            <p class="text-gray-600 mb-4">Do not use the current time in milliseconds to generate unique IDs in your Test Data Factory, as multi-server environments can have time drift, leading to duplicate IDs and test failures. Instead, use <code>System.UUID</code> to generate unique identifiers, as recommended by Salesforce (<a href="https://developer.salesforce.com/docs/atlas.en-us.apexref.meta/apexref/apex_class_System_UUID.htm" class="text-blue-600 hover:underline">System.UUID Docs</a>).</p>
            <p class="text-gray-600 mb-4"><strong>Example of What to Avoid:</strong></p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice1a">// Bad Practice
String uniqueId = String.valueOf(System.currentTimeMillis());
Account acc = new Account(Name = 'Test Account ' + uniqueId);</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice1a')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>Recommended Approach:</strong> Use <code>System.UUID</code> to generate a unique ID.</p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice1b">// Good Practice
String uniqueId = System.UUID.randomUUID().toString();
Account acc = new Account(Name = 'Test Account ' + uniqueId);</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice1b')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>DevOps Check:</strong> Add a static code analysis rule in your pipeline (e.g., using PMD or CodeScan) to flag usage of <code>System.currentTimeMillis()</code> in test classes and enforce the use of <code>System.UUID</code>.</p>
          </div>

          <!-- Practice 2: Avoid Editing Permission Set Groups in Tests -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Do Not Edit Permission Set Groups (PSG) in Test Classes</h3>
            <p class="text-gray-600 mb-4">Editing Permission Set Groups in test classes can lead to the "PSG status not in Updated" bug, causing test failures and deployment issues.</p>
            <p class="text-gray-600 mb-4"><strong>Example of What to Avoid:</strong></p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice2a">// Bad Practice
@TestSetup
void testUpdatePSG() {
    PermissionSetGroup psg = [SELECT Id FROM PermissionSetGroup WHERE DeveloperName = 'MyPSG' LIMIT 1];
    psg.Status = 'Updated';
    update psg; // This can cause the PSG status bug
}</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice2a')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>Recommended Approach:</strong> Mock permission-related logic using dependency injection or avoid modifying PSGs in tests.</p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice2b">// Good Practice
@TestSetup
static void setup() {
    PermissionSet ps = [SELECT Id FROM PermissionSet WHERE Name = 'MyPS' LIMIT 1];
    insert new PermissionSetAssignment(AssigneeId = UserInfo.getUserId(), PermissionSetId = ps.Id);
}</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice2b')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>DevOps Check:</strong> Use a custom static code analysis rule to detect DML operations on <code>PermissionSetGroup</code> objects in test classes.</p>
          </div>

          <!-- Practice 3: Optimize SOQL Queries with Explain Plan -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Optimize SOQL Queries Using Explain Plan</h3>
            <p class="text-gray-600 mb-4">Review SOQL queries in your Apex codebase and run an Explain Plan to identify optimization opportunities, such as adding custom indexes.</p>
            <p class="text-gray-600 mb-4"><strong>Example of a Potentially Inefficient Query:</strong></p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice3a">// Potentially Inefficient
List<Account> accounts = [SELECT Id, Name FROM Account WHERE CreatedDate > :someDate];</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice3a')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>How to Optimize:</strong> Run an Explain Plan in the Developer Consoleâ€™s Query Editor to check the queryâ€™s cost and selectivity. Add a custom index if needed.</p>
            <div class="relative">
              <pre class="language-text"><code id="code-practice3b">Steps to Run Explain Plan:
1. Open Developer Console > Query Editor
2. Enter your SOQL query
3. Click "Query Plan" to analyze cost
4. If cost is high, consider adding a custom index on fields like CreatedDate</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice3b')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>DevOps Check:</strong> Integrate a script in your pipeline to extract SOQL queries from Apex code and run Explain Plans programmatically using the Salesforce REST API (<code>/tooling/query/?explain=</code>).</p>
          </div>

          <!-- Practice 4: Avoid SOQL 101 Errors in Loops -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Prevent SOQL 101 Errors in Apex Loops</h3>
            <p class="text-gray-600 mb-4">Be cautious with Apex loops that execute SOQL queries, as they can lead to the "SOQL 101" governor limit error (too many SOQL queries in a single transaction).</p>
            <p class="text-gray-600 mb-4"><strong>Example of a Problematic Loop:</strong></p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice4a">// Bad Practice
for (Account acc : [SELECT Id FROM Account LIMIT 200]) {
    List<Contact> contacts = [SELECT Id FROM Contact WHERE AccountId = :acc.Id];
}</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice4a')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>Recommended Approach:</strong> Bulkify the query by collecting IDs and querying outside the loop.</p>
            <div class="relative">
              <pre class="language-apex"><code id="code-practice4b">// Good Practice
Set<Id> accountIds = new Set<Id>();
for (Account acc : [SELECT Id FROM Account LIMIT 200]) {
    accountIds.add(acc.Id);
}
List<Contact> contacts = [SELECT Id, AccountId FROM Contact WHERE AccountId IN :accountIds];</code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice4b')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>DevOps Check:</strong> Use static analysis tools (e.g., PMD with the Apex rule <code>ApexSOQLInjection</code>) to detect SOQL queries inside loops and enforce bulkification.</p>
          </div>

          <!-- Practice 5: Clean Up Permissions and Permission Sets -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">ðŸ”¹ Clean Up Permissions and Permission Sets</h3>
            <p class="text-gray-600 mb-4">Ensure you clean up Permissions and Permission Sets to remove duplicate and dangling permissions. Dangling permissions can cause deployment errors, while duplicates bloat metadata files and go unnoticed.</p>
            <p class="text-gray-600 mb-4"><strong>Example of a Problematic Permission Set:</strong></p>
            <div class="relative">
              <pre class="language-xml"><code id="code-practice5a"><!-- Problematic Permission Set with Duplicates -->
<PermissionSet xmlns="http://soap.sforce.com/2006/04/metadata">
    <userPermissions>
        <enabled>true</enabled>
        <name>ViewAllData</name>
    </userPermissions>
    <userPermissions>
        <enabled>true</enabled>
        <name>ViewAllData</name> <!-- Duplicate -->
    </userPermissions>
</PermissionSet></code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice5a')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>Recommended Approach:</strong> Remove duplicates and ensure no dangling references exist.</p>
            <div class="relative">
              <pre class="language-xml"><code id="code-practice5b"><!-- Cleaned Permission Set -->
<PermissionSet xmlns="http://soap.sforce.com/2006/04/metadata">
    <userPermissions>
        <enabled>true</enabled>
        <name>ViewAllData</name>
    </userPermissions>
</PermissionSet></code></pre>
              <button class="copy-btn absolute top-2 right-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700" onclick="copyCode('code-practice5b')">Copy</button>
            </div>
            <p class="text-gray-600 mt-4"><strong>DevOps Check:</strong> Use a script in your pipeline to parse Permission Set metadata and flag duplicates or dangling references before deployment. Tools like <code>sfdx-scanner</code> can help identify issues.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-blue-600 text-white py-6">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p>MC - Salesforce Development Best Practices Guide</p>
    </div>
  </footer>

  <!-- Prism.js JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-apex.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-text.min.js"></script>

  <!-- JavaScript for Copy Functionality -->
  <script>
    function copyCode(elementId) {
      const codeElement = document.getElementById(elementId);
      const text = codeElement.innerText;
      navigator.clipboard.writeText(text).then(() => {
        alert('Code copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
  </script>
</body>
</html>