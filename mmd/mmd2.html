<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mermaid Editor</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://mohan-chinnappan-n.github.io/sfdc/gs/css/split.css" />
  <link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n5.github.io/dfv/img/mc_favIcon.ico">

  <style>
    /* Glassmorphism Card Style */
    .glass {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 1rem;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    #mermaid-input {
      font-family: "Monaco", monospace;
      font-size: small;
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      border-radius: 0.75rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    body {
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      min-height: 100vh;
    }
  </style>

  <script type="module">
    Split(["#code", "#fig"], { sizes: [50, 50] });

    import mermaid from "https://unpkg.com/mermaid@10.9.0/dist/mermaid.esm.min.mjs";

    const sample = `
flowchart TB
  A[Reference Docs, Websites...] --> B[RAG System]  --> C[LLM] --> LLM[embeddings] --> VDB[Vector DB of embeddings]
  Q[User Query] --> E[LLM] --> F[Query Vector ] --> B  --> G[Find the relevant context docs using cosine similarity] --> H[Context Chunks] --> HH[Augmented Query - Question and context]
  HH --> I[LLM - Geneation] --> R[Response]
  B --> VDB

  style A fill:#f9f,stroke:#333,stroke-width:4px
  style B fill:#9ff,stroke:#333,stroke-width:4px
  style Q fill:#ff9,stroke:#333,stroke-width:4px
  style R fill:#99ccff,stroke:#333,stroke-width:4px
    `;

    document.addEventListener("DOMContentLoaded", function () {
      mermaid.initialize({ startOnLoad: true, securityLevel: 'loose', maxTextSize: 300000, maxEdges: 10000 });
      document.getElementById("mermaid-input").value = sample;

      const renderMermaid = () => {
        const input = document.getElementById("mermaid-input").value;
        const output = document.getElementById("mermaid-output");

        try {
          output.innerHTML = "";
          const uniqueId = "generatedDiagram";
          const tempDiv = document.createElement("div");
          tempDiv.id = uniqueId;
          output.appendChild(tempDiv);

          mermaid.render(uniqueId, input).then(({ svg }) => {
            output.innerHTML = svg;
            document.getElementById("download-svg").disabled = false;
          });
        } catch (error) {
          output.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
          document.getElementById("download-svg").disabled = true;
        }
      };

      renderMermaid();
      document.getElementById("mermaid-input").addEventListener("input", renderMermaid);

      document.getElementById("download-svg").addEventListener("click", () => {
        const svgContent = document.querySelector("#mermaid-output svg");
        if (svgContent) {
          const blob = new Blob([svgContent.outerHTML], { type: "image/svg+xml" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "mermaid_diagram.svg";
          link.click();
        }
      });
    });
  </script>
  <script src="https://mohan-chinnappan-n.github.io/sfdc/gs/js/split.js"></script>
</head>

<body class="font-sans leading-normal tracking-normal text-white">
  <!-- Navbar -->
  <nav class="glass text-white p-4 fixed w-full z-10 top-0 shadow-lg">
    <div class="container mx-auto flex justify-between items-center">
      <a href="#" class="text-xl font-semibold">✨ Mermaid Editor</a>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="split split-horizontal pt-20" id="code">
    <div id="left-pane" class="pane glass m-4 p-4">
      <h2 class="text-lg font-bold mb-4">Enter Mermaid Code</h2>
      <textarea id="mermaid-input" class="w-full h-96 p-4 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
    </div>
  </div>

  <div class="split split-horizontal pt-20" id="fig">
    <div id="right-pane" class="pane glass m-4 p-4">
      <h2 class="text-lg font-bold mb-4">Rendered Diagram</h2>
      <div id="mermaid-output" class="glass p-4 rounded-md overflow-auto">
        <p class="text-gray-200">Your diagram will appear here after rendering.</p>
      </div>
      <button id="download-svg" class="mt-4 p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md disabled:opacity-50" disabled>
        ⬇ Download SVG
      </button>
    </div>
  </div>
</body>
</html>
