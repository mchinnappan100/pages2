<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Video Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            flex-direction: column;
        }

        .header {
            background: #2d2d2d;
            padding: 10px 20px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: #252525;
            border-right: 1px solid #444;
            padding: 20px;
            overflow-y: auto;
        }

        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .preview-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #1e1e1e;
            position: relative;
        }

        .video-container {
            position: relative;
            max-width: 100%;
            max-height: 100%;
        }

        #videoPreview {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .upload-area {
            border: 2px dashed #666;
            border-radius: 12px;
            padding: 60px;
            text-align: center;
            background: #2a2a2a;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #4CAF50;
            background: #2f2f2f;
        }

        .upload-area.dragover {
            border-color: #4CAF50;
            background: #2f4f2f;
        }

        .timeline-area {
            height: 200px;
            background: #2a2a2a;
            border-top: 1px solid #444;
            padding: 20px;
            overflow-x: auto;
        }

        .timeline {
            height: 100%;
            background: #333;
            border-radius: 8px;
            position: relative;
            min-width: 100%;
        }

        .timeline-track {
            height: 60px;
            background: #4CAF50;
            border-radius: 4px;
            margin: 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .timeline-track:hover {
            background: #5CBF60;
        }

        .trim-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 12px; /* Increased width for visibility */
            background: #fff;
            cursor: ew-resize;
            border-radius: 4px;
            opacity: 1; /* Full opacity for visibility */
            z-index: 5;
            border: 1px solid #333;
        }

        .trim-handle.left {
            left: -6px;
        }

        .trim-handle.right {
            right: -6px;
        }

        .playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ff4444;
            z-index: 10;
            pointer-events: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: #666;
        }

        .btn.secondary:hover {
            background: #777;
        }

        .btn.danger {
            background: #f44336;
        }

        .btn.danger:hover {
            background: #da190b;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #4CAF50;
            font-size: 16px;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #ccc;
        }

        .slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: #444;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
        }

        .range-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .range-inputs input {
            width: 100px;
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 5px;
            border-radius: 4px;
        }

        .video-info {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .timeline-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .time-display {
            font-family: monospace;
            font-size: 14px;
            background: #333;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.1s ease;
        }

        .export-section {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .format-select {
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 10px;
        }

        .quality-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quality-btn {
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .quality-btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        .segments-list {
            max-height: 200px;
            overflow-y: auto;
            background: #333;
            border-radius: 8px;
            padding: 10px;
        }

        .segment-item {
            background: #444;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .segment-time {
            font-family: monospace;
            font-size: 12px;
            color: #ccc;
        }

        .segment-actions {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: #555;
            color: white;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üé¨ Video Editor Pro</div>
            <div class="controls">
                <button class="btn" onclick="exportVideo()">
                    <span>üì§</span> Export Video
                </button>
                <button class="btn secondary" onclick="resetEditor()">
                    <span>üîÑ</span> Reset
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <h3>üìÅ Video Upload</h3>
                    <div class="controls">
                        <button class="btn" onclick="triggerFileInput()">
                            <span>üìÇ</span> Select Video
                        </button>
                    </div>
                    <input type="file" id="fileInput" accept="video/mp4,video/webm,video/avi,video/mov" onchange="handleFileSelect(event)">
                </div>

                <div id="videoInfoSection" class="section" style="display: none;">
                    <h3>üìä Video Info</h3>
                    <div class="video-info" id="videoInfo">
                        <div class="info-row">
                            <span>Duration:</span>
                            <span id="videoDuration">--:--</span>
                        </div>
                        <div class="info-row">
                            <span>Resolution:</span>
                            <span id="videoResolution">-- x --</span>
                        </div>
                        <div class="info-row">
                            <span>Size:</span>
                            <span id="videoSize">-- MB</span>
                        </div>
                        <div class="info-row">
                            <span>Format:</span>
                            <span id="videoFormat">--</span>
                        </div>
                    </div>
                </div>

                <div id="editingControls" class="section" style="display: none;">
                    <h3>‚úÇÔ∏è Editing Tools</h3>
                    <div class="controls">
                        <button class="btn" onclick="addCutPoint()">
                            <span>‚úÇÔ∏è</span> Cut Here
                        </button>
                        <button class="btn secondary" onclick="undoLastCut()">
                            <span>‚Ü∂</span> Undo Cut
                        </button>
                    </div>
                    <div class="controls">
                        <button class="btn" onclick="trimVideo()">
                            <span>üìè</span> Trim Selection
                        </button>
                        <button class="btn secondary" onclick="duplicateSegment()">
                            <span>üìã</span> Duplicate
                        </button>
                    </div>
                    <div class="slider-group">
                        <label>Trim Range (seconds)</label>
                        <div class="range-inputs">
                            <input type="number" id="trimStart" min="0" step="0.1" placeholder="Start">
                            <input type="number" id="trimEnd" min="0" step="0.1" placeholder="End">
                            <button class="btn" onclick="applyTrimRange()">Apply</button>
                        </div>
                    </div>
                </div>

                <div id="segmentsSection" class="section" style="display: none;">
                    <h3>üéûÔ∏è Video Segments</h3>
                    <div class="segments-list" id="segmentsList">
                        <!-- Segments will be populated here -->
                    </div>
                    <div class="controls">
                        <button class="btn" onclick="joinAllSegments()">
                            <span>üîó</span> Join All
                        </button>
                        <button class="btn danger" onclick="clearAllSegments()">
                            <span>üóëÔ∏è</span> Clear All
                        </button>
                    </div>
                </div>

                <div id="adjustmentControls" class="section" style="display: none;">
                    <h3>üé® Adjustments</h3>
                    <div class="slider-group">
                        <label>Volume</label>
                        <input type="range" class="slider" id="volumeSlider" min="0" max="200" value="100" oninput="adjustVolume(this.value)">
                    </div>
                    <div class="slider-group">
                        <label>Playback Speed</label>
                        <input type="range" class="slider" id="speedSlider" min="25" max="300" value="100" oninput="adjustSpeed(this.value)">
                    </div>
                    <div class="slider-group">
                        <label>Brightness</label>
                        <input type="range" class="slider" id="brightnessSlider" min="0" max="200" value="100" oninput="adjustBrightness(this.value)">
                    </div>
                    <div class="slider-group">
                        <label>Contrast</label>
                        <input type="range" class="slider" id="contrastSlider" min="0" max="200" value="100" oninput="adjustContrast(this.value)">
                    </div>
                </div>

                <div class="export-section">
                    <h3>üì§ Export Settings</h3>
                    <select class="format-select" id="exportFormat">
                        <option value="mp4">MP4 (Recommended)</option>
                        <option value="webm">WebM</option>
                        <option value="avi">AVI</option>
                    </select>
                    <div class="quality-options">
                        <button class="quality-btn" onclick="setQuality('720p')">720p</button>
                        <button class="quality-btn active" onclick="setQuality('1080p')">1080p</button>
                        <button class="quality-btn" onclick="setQuality('4k')">4K</button>
                    </div>
                </div>
            </div>

            <div class="workspace">
                <div class="preview-area">
                    <div class="upload-area" id="uploadArea" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="triggerFileInput()">
                        <div>
                            <h2>üé¨ Drop your video here</h2>
                            <p>or click to browse files</p>
                            <p style="margin-top: 10px; font-size: 14px; color: #999;">
                                Supports: MP4, WebM, AVI, MOV
                            </p>
                        </div>
                    </div>
                    <div class="video-container" id="videoContainer" style="display: none;">
                        <video id="videoPreview" controls></video>
                    </div>
                </div>

                <div class="timeline-area">
                    <div class="timeline-controls">
                        <button class="btn" onclick="playPause()">
                            <span id="playPauseIcon">‚ñ∂Ô∏è</span>
                        </button>
                        <div class="time-display">
                            <span id="currentTime">00:00</span> / <span id="totalTime">00:00</span>
                        </div>
                        <div class="progress-bar" onclick="seekTo(event)">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                    <div class="timeline" id="timeline">
                        <div class="playhead" id="playhead"></div>
                        <!-- Timeline tracks will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Global variables
        let currentVideo = null;
        let videoSegments = [];
        let cutPoints = [];
        let isPlaying = false;
        let currentQuality = '1080p';
        let selectedSegment = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            const video = document.getElementById('videoPreview');
            video.addEventListener('loadedmetadata', onVideoLoaded);
            video.addEventListener('timeupdate', onTimeUpdate);
            video.addEventListener('ended', onVideoEnded);
            video.addEventListener('error', onVideoError);
            
            // Initialize timeline
            updateTimeline();
        }

        function triggerFileInput() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('video/')) {
                loadVideo(file);
            } else {
                showNotification('Please select a valid video file', 'error');
            }
        }

        function handleDrop(event) {
            event.preventDefault();
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('video/')) {
                    loadVideo(file);
                } else {
                    showNotification('Please select a valid video file', 'error');
                }
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
        }

        function loadVideo(file) {
            showLoading(true);
            
            const video = document.getElementById('videoPreview');
            const url = URL.createObjectURL(file);
            
            video.src = url;
            currentVideo = {
                file: file,
                url: url,
                name: file.name,
                size: file.size,
                type: file.type
            };

            // Show video container and hide upload area
            document.getElementById('uploadArea').style.display = 'none';
            document.getElementById('videoContainer').style.display = 'block';
            
            // Initialize segments with full video
            videoSegments = [{
                id: 'main',
                startTime: 0,
                endTime: 0, // Will be set when metadata loads
                name: 'Main Video'
            }];
            
            showNotification('Video loading...');
        }

        function onVideoLoaded() {
            const video = document.getElementById('videoPreview');
            const duration = isFinite(video.duration) && !isNaN(video.duration) ? video.duration : 0;
            
            // Update main segment duration
            if (videoSegments.length > 0) {
                videoSegments[0].endTime = duration;
            }
            
            // Update video info
            updateVideoInfo();
            
            // Show relevant sections
            showSection('videoInfoSection');
            showSection('editingControls');
            showSection('adjustmentControls');
            
            // Update timeline
            updateTimeline();
            updateSegmentsList();
            showLoading(false);
            showNotification('Video loaded successfully!');
        }

        function onVideoError() {
            showLoading(false);
            showNotification('Failed to load video. Please try a different file.', 'error');
            resetEditor();
        }

        function updateVideoInfo() {
            const video = document.getElementById('videoPreview');
            const duration = isFinite(video.duration) && !isNaN(video.duration) ? video.duration : 0;
            
            document.getElementById('videoDuration').textContent = formatTime(duration);
            document.getElementById('videoResolution').textContent = `${video.videoWidth || '--'} x ${video.videoHeight || '--'}`;
            document.getElementById('videoSize').textContent = currentVideo ? `${(currentVideo.size / (1024 * 1024)).toFixed(1)} MB` : '-- MB';
            document.getElementById('videoFormat').textContent = currentVideo ? currentVideo.type.split('/')[1].toUpperCase() : '--';
            
            // Update trim range inputs
            document.getElementById('trimEnd').max = duration;
        }

        function onTimeUpdate() {
            const video = document.getElementById('videoPreview');
            const currentTime = video.currentTime;
            const duration = isFinite(video.duration) && !isNaN(video.duration) ? video.duration : 0;
            
            // Update time display
            document.getElementById('currentTime').textContent = formatTime(currentTime);
            document.getElementById('totalTime').textContent = formatTime(duration);
            
            // Update progress bar
            const progress = duration > 0 ? (currentTime / duration) * 100 : 0;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update playhead position
            updatePlayheadPosition(progress);
        }

        function onVideoEnded() {
            isPlaying = false;
            document.getElementById('playPauseIcon').textContent = '‚ñ∂Ô∏è';
        }

        function playPause() {
            const video = document.getElementById('videoPreview');
            const icon = document.getElementById('playPauseIcon');
            
            if (isPlaying) {
                video.pause();
                icon.textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
            } else {
                video.play().catch(() => {
                    showNotification('Playback failed. Please try again.', 'error');
                });
                icon.textContent = '‚è∏Ô∏è';
                isPlaying = true;
            }
        }

        function seekTo(event) {
            const video = document.getElementById('videoPreview');
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            video.currentTime = percentage * video.duration;
        }

        function addCutPoint() {
            const video = document.getElementById('videoPreview');
            const currentTime = video.currentTime;
            
            if (!isFinite(currentTime)) {
                showNotification('Cannot add cut point: Invalid video time', 'error');
                return;
            }
            
            if (!cutPoints.includes(currentTime)) {
                cutPoints.push(currentTime);
                cutPoints.sort((a, b) => a - b);
                
                // Split segments based on cut points
                updateSegmentsFromCuts();
                updateTimeline();
                updateSegmentsList();
                
                showNotification(`Cut point added at ${formatTime(currentTime)}`);
                showSection('segmentsSection');
            } else {
                showNotification('Cut point already exists at this time', 'error');
            }
        }

        function undoLastCut() {
            if (cutPoints.length > 0) {
                const removedPoint = cutPoints.pop();
                updateSegmentsFromCuts();
                updateTimeline();
                updateSegmentsList();
                showNotification(`Removed cut point at ${formatTime(removedPoint)}`);
                
                if (cutPoints.length === 0) {
                    hideSection('segmentsSection');
                }
            }
        }

        function updateSegmentsFromCuts() {
            if (!currentVideo) return;
            
            const video = document.getElementById('videoPreview');
            const duration = isFinite(video.duration) ? video.duration : 0;
            
            videoSegments = [];
            let startTime = 0;
            
            cutPoints.forEach((cutPoint, index) => {
                if (cutPoint <= duration) {
                    videoSegments.push({
                        id: `segment_${index}`,
                        startTime: startTime,
                        endTime: cutPoint,
                        name: `Segment ${index + 1}`
                    });
                    startTime = cutPoint;
                }
            });
            
            // Add final segment
            if (startTime < duration) {
                videoSegments.push({
                    id: `segment_${cutPoints.length}`,
                    startTime: startTime,
                    endTime: duration,
                    name: `Segment ${cutPoints.length + 1}`
                });
            }
        }

        function trimVideo() {
            const start = parseFloat(document.getElementById('trimStart').value);
            const end = parseFloat(document.getElementById('trimEnd').value);
            applyTrimRange(start, end);
        }

        function applyTrimRange(start, end) {
            const video = document.getElementById('videoPreview');
            const duration = isFinite(video.duration) ? video.duration : 0;
            
            if (isNaN(start) || isNaN(end) || start < 0 || end > duration || start >= end) {
                showNotification('Invalid trim range', 'error');
                return;
            }
            
            videoSegments = [{
                id: 'trimmed',
                startTime: start,
                endTime: end,
                name: 'Trimmed Segment'
            }];
            
            cutPoints = [];
            updateTimeline();
            updateSegmentsList();
            showSection('segmentsSection');
            showNotification(`Video trimmed to ${formatTime(start)} - ${formatTime(end)}`);
        }

        function duplicateSegment() {
            if (selectedSegment !== null) {
                const segment = videoSegments[selectedSegment];
                videoSegments.push({
                    id: `segment_${videoSegments.length}`,
                    startTime: segment.startTime,
                    endTime: segment.endTime,
                    name: `Copy of ${segment.name}`
                });
                updateTimeline();
                updateSegmentsList();
                showNotification('Segment duplicated');
            } else {
                showNotification('Please select a segment to duplicate', 'error');
            }
        }

        function joinAllSegments() {
            const video = document.getElementById('videoPreview');
            cutPoints = [];
            videoSegments = [{
                id: 'main',
                startTime: 0,
                endTime: isFinite(video.duration) ? video.duration : 0,
                name: 'Main Video'
            }];
            
            updateTimeline();
            updateSegmentsList();
            hideSection('segmentsSection');
            showNotification('All segments joined');
        }

        function clearAllSegments() {
            cutPoints = [];
            videoSegments = [];
            updateTimeline();
            updateSegmentsList();
            hideSection('segmentsSection');
            showNotification('All segments cleared');
        }

        function updateTimeline() {
            const timeline = document.getElementById('timeline');
            const tracksContainer = timeline.querySelector('.timeline-tracks') || document.createElement('div');
            tracksContainer.className = 'timeline-tracks';
            tracksContainer.innerHTML = '';
            
            if (videoSegments.length === 0) return;
            
            const video = document.getElementById('videoPreview');
            const totalDuration = isFinite(video.duration) ? video.duration : 1;
            
            videoSegments.forEach((segment, index) => {
                const track = document.createElement('div');
                track.className = 'timeline-track';
                track.style.left = (segment.startTime / totalDuration * 100) + '%';
                track.style.width = ((segment.endTime - segment.startTime) / totalDuration * 100) + '%';
                track.title = segment.name;
                
                // Add trim handles with drag functionality
                const leftHandle = document.createElement('div');
                leftHandle.className = 'trim-handle left';
                leftHandle.addEventListener('mousedown', (e) => startDragging(e, index, 'left'));
                
                const rightHandle = document.createElement('div');
                rightHandle.className = 'trim-handle right';
                rightHandle.addEventListener('mousedown', (e) => startDragging(e, index, 'right'));
                
                track.appendChild(leftHandle);
                track.appendChild(rightHandle);
                tracksContainer.appendChild(track);
                
                // Highlight selected segment
                track.addEventListener('click', () => {
                    selectedSegment = index;
                    updateSegmentsList();
                });
            });
            
            if (!timeline.contains(tracksContainer)) {
                timeline.appendChild(tracksContainer);
            }
        }

        function startDragging(event, segmentIndex, handleSide) {
            const video = document.getElementById('videoPreview');
            const totalDuration = isFinite(video.duration) ? video.duration : 1;
            const timeline = document.getElementById('timeline');
            const rect = timeline.getBoundingClientRect();
            
            const moveHandler = (e) => {
                const x = e.clientX - rect.left;
                const percentage = Math.max(0, Math.min(1, x / rect.width));
                const time = percentage * totalDuration;
                
                if (handleSide === 'left') {
                    videoSegments[segmentIndex].startTime = Math.min(time, videoSegments[segmentIndex].endTime - 0.1);
                } else {
                    videoSegments[segmentIndex].endTime = Math.max(time, videoSegments[segmentIndex].startTime + 0.1);
                }
                
                updateTimeline();
                updateSegmentsList();
            };
            
            const stopHandler = () => {
                document.removeEventListener('mousemove', moveHandler);
                document.removeEventListener('mouseup', stopHandler);
                showNotification('Trim handle adjusted');
            };
            
            document.addEventListener('mousemove', moveHandler);
            document.addEventListener('mouseup', stopHandler);
        }

        function updatePlayheadPosition(percentage) {
            const playhead = document.getElementById('playhead');
            playhead.style.left = percentage + '%';
        }

        function updateSegmentsList() {
            const segmentsList = document.getElementById('segmentsList');
            segmentsList.innerHTML = '';
            
            videoSegments.forEach((segment, index) => {
                const segmentItem = document.createElement('div');
                segmentItem.className = `segment-item ${selectedSegment === index ? 'selected' : ''}`;
                segmentItem.style.background = selectedSegment === index ? '#5CBF60' : '#444';
                
                const duration = segment.endTime - segment.startTime;
                
                segmentItem.innerHTML = `
                    <div>
                        <div>${segment.name}</div>
                        <div class="segment-time">${formatTime(segment.startTime)} - ${formatTime(segment.endTime)} (${formatTime(duration)})</div>
                    </div>
                    <div class="segment-actions">
                        <button class="icon-btn" onclick="playSegment(${index})" title="Play">‚ñ∂Ô∏è</button>
                        <button class="icon-btn" onclick="deleteSegment(${index})" title="Delete">üóëÔ∏è</button>
                    </div>
                `;
                
                segmentsList.appendChild(segmentItem);
            });
        }

        function playSegment(index) {
            const segment = videoSegments[index];
            const video = document.getElementById('videoPreview');
            
            video.currentTime = segment.startTime;
            video.play().catch(() => {
                showNotification('Playback failed. Please try again.', 'error');
            });
            isPlaying = true;
            document.getElementById('playPauseIcon').textContent = '‚è∏Ô∏è';
            
            // Set up a listener to stop at segment end
            const stopAtEnd = () => {
                if (video.currentTime >= segment.endTime) {
                    video.pause();
                    isPlaying = false;
                    document.getElementById('playPauseIcon').textContent = '‚ñ∂Ô∏è';
                    video.removeEventListener('timeupdate', stopAtEnd);
                }
            };
            
            video.addEventListener('timeupdate', stopAtEnd);
        }

        function deleteSegment(index) {
            videoSegments.splice(index, 1);
            if (selectedSegment === index) selectedSegment = null;
            updateTimeline();
            updateSegmentsList();
            showNotification('Segment deleted');
        }

        function adjustVolume(value) {
            const video = document.getElementById('videoPreview');
            video.volume = value / 100;
        }

        function adjustSpeed(value) {
            const video = document.getElementById('videoPreview');
            video.playbackRate = value / 100;
        }

        function adjustBrightness(value) {
            const video = document.getElementById('videoPreview');
            video.style.filter = `brightness(${value}%) contrast(${document.getElementById('contrastSlider').value}%)`;
        }

        function adjustContrast(value) {
            const video = document.getElementById('videoPreview');
            video.style.filter = `brightness(${document.getElementById('brightnessSlider').value}%) contrast(${value}%)`;
        }

        function setQuality(quality) {
            currentQuality = quality;
            
            // Update active quality button
            document.querySelectorAll('.quality-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            showNotification(`Quality set to ${quality}`);
        }

        function exportVideo() {
            // Placeholder for export logic
            showNotification('Export functionality would be implemented here');
        }

        function resetEditor() {
            // Reset all state and UI
            currentVideo = null;
            videoSegments = [];
            cutPoints = [];
            isPlaying = false;
            currentQuality = '1080p';
            selectedSegment = null;

            // Reset video preview
            const video = document.getElementById('videoPreview');
            video.src = '';
            video.removeAttribute('src');
            video.load();

            // Hide sections
            hideSection('videoInfoSection');
            hideSection('editingControls');
            hideSection('adjustmentControls');
            hideSection('segmentsSection');

            // Hide video, show upload
            document.getElementById('videoContainer').style.display = 'none';
            document.getElementById('uploadArea').style.display = 'flex';

            // Reset timeline and segments
            updateTimeline();
            updateSegmentsList();

            // Reset sliders
            document.getElementById('volumeSlider').value = 100;
            document.getElementById('speedSlider').value = 100;
            document.getElementById('brightnessSlider').value = 100;
            document.getElementById('contrastSlider').value = 100;

            // Reset trim inputs
            document.getElementById('trimStart').value = '';
            document.getElementById('trimEnd').value = '';

            showNotification('Editor reset');
        }

        // Utility functions
        function showSection(id) {
            document.getElementById(id).style.display = '';
        }
        function hideSection(id) {
            document.getElementById(id).style.display = 'none';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function showNotification(message, type = '') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            text.textContent = message;
            notification.className = 'notification' + (type ? ' ' + type : '');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        function formatTime(seconds) {
            if (!isFinite(seconds) || isNaN(seconds) || seconds < 0) {
                return '00:00';
            }
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>