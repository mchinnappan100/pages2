<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editor Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: #2d2d2d;
            padding: 10px 20px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #ff6b35;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: #252525;
            border-right: 1px solid #444;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: #ff6b35;
            font-size: 16px;
        }

        .tool-group {
            margin-bottom: 25px;
        }

        .tool-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: #3a3a3a;
            border: none;
            border-radius: 6px;
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background: #ff6b35;
            transform: translateX(5px);
        }

        .tool-btn.active {
            background: #ff6b35;
        }

        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
        }

        .preview-section {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .video-container {
            position: relative;
            max-width: 100%;
            max-height: 100%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .main-video {
            width: 100%;
            height: auto;
            max-height: 70vh;
            display: block;
        }

        .upload-area {
            width: 600px;
            height: 400px;
            border: 3px dashed #ff6b35;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 107, 53, 0.1);
        }

        .upload-area:hover {
            border-color: #ff8c42;
            background: rgba(255, 107, 53, 0.2);
            transform: scale(1.02);
        }

        .upload-area.dragover {
            border-color: #42ff71;
            background: rgba(66, 255, 113, 0.2);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ff6b35;
        }

        .upload-text {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }

        .upload-subtext {
            font-size: 14px;
            color: #aaa;
            text-align: center;
        }

        .timeline-section {
            height: 200px;
            background: #2d2d2d;
            border-top: 1px solid #444;
            padding: 15px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .timeline-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .timeline-ruler {
            height: 30px;
            background: #3a3a3a;
            border-radius: 4px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        .timeline-track {
            height: 60px;
            background: #404040;
            border-radius: 6px;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .timeline-track.active {
            border-color: #ff6b35;
        }

        .video-clip {
            position: absolute;
            height: 100%;
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .video-clip:hover {
            transform: scale(1.05);
            border-color: #fff;
        }

        .video-clip.selected {
            border-color: #42ff71;
            box-shadow: 0 0 15px rgba(66, 255, 113, 0.5);
        }

        .audio-clip {
            background: linear-gradient(45deg, #4a90e2, #5ba0f2);
        }

        .controls-panel {
            background: #2d2d2d;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            border-top: 1px solid #444;
        }

        .control-btn {
            background: #ff6b35;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: #ff8c42;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .control-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .time-display {
            background: #404040;
            padding: 8px 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            color: #ff6b35;
            border: 1px solid #555;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: #404040;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            margin: 0 15px;
        }

        .progress-fill {
            height: 100%;
            background: #ff6b35;
            border-radius: 3px;
            transition: width 0.1s ease;
        }

        .progress-handle {
            position: absolute;
            top: -5px;
            width: 16px;
            height: 16px;
            background: #ff6b35;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #fff;
        }

        .progress-handle:hover {
            transform: scale(1.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            color: white;
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #ff6b35;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #404040;
            color: white;
            font-size: 14px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-secondary {
            background: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: #777;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            color: #ff6b35;
            font-size: 18px;
            padding: 20px;
        }

        .track-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #ccc;
            pointer-events: none;
        }

        .export-progress {
            width: 100%;
            height: 20px;
            background: #404040;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .export-progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            transition: width 0.3s ease;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .processing {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">🎬 Video Editor Pro</div>
            <div style="display: flex; gap: 10px;">
                <button class="control-btn" onclick="exportVideo()">
                    📤 Export Video
                </button>
                <button class="control-btn" onclick="saveProject()">
                    💾 Save Project
                </button>
            </div>
        </header>

        <div class="main-content">
            <div class="sidebar">
                <div class="tool-group">
                    <h3>📁 Media</h3>
                    <button class="tool-btn" onclick="document.getElementById('videoInput').click()">
                        📹 Add Video
                    </button>
                    <button class="tool-btn" onclick="document.getElementById('audioInput').click()">
                        🎵 Add Audio
                    </button>
                </div>

                <div class="tool-group">
                    <h3>✂️ Edit Tools</h3>
                    <button class="tool-btn" onclick="splitClip()">
                        ✂️ Split
                    </button>
                    <button class="tool-btn" onclick="trimClip()">
                        📐 Trim
                    </button>
                    <button class="tool-btn" onclick="deleteClip()">
                        🗑️ Delete
                    </button>
                    <button class="tool-btn" onclick="duplicateClip()">
                        📋 Duplicate
                    </button>
                </div>

                <div class="tool-group">
                    <h3>🎨 Effects</h3>
                    <button class="tool-btn" onclick="addTransition()">
                        🌊 Transition
                    </button>
                    <button class="tool-btn" onclick="adjustSpeed()">
                        ⚡ Speed
                    </button>
                    <button class="tool-btn" onclick="addFilter()">
                        🎭 Filter
                    </button>
                </div>

                <div class="tool-group">
                    <h3>🔊 Audio</h3>
                    <button class="tool-btn" onclick="adjustVolume()">
                        🔊 Volume
                    </button>
                    <button class="tool-btn" onclick="fadeAudio()">
                        📉 Fade
                    </button>
                    <button class="tool-btn" onclick="muteTrack()">
                        🔇 Mute
                    </button>
                </div>
            </div>

            <div class="editor-area">
                <div class="preview-section">
                    <div id="uploadArea" class="upload-area">
                        <div class="upload-icon">📹</div>
                        <div class="upload-text">Drop your video files here</div>
                        <div class="upload-subtext">or click to browse • Supports MP4, WebM</div>
                    </div>
                    
                    <div id="videoContainer" class="video-container hidden">
                        <video id="mainVideo" class="main-video" controls>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>

                <div class="timeline-section">
                    <div class="timeline-container">
                        <div class="timeline-ruler">
                            <div id="timelineMarker" style="position: absolute; top: 0; width: 2px; height: 100%; background: #ff6b35; left: 0;"></div>
                        </div>
                        
                        <div class="timeline-track" id="videoTrack">
                            <div class="track-label">Video</div>
                        </div>
                        
                        <div class="timeline-track" id="audioTrack">
                            <div class="track-label">Audio</div>
                        </div>
                    </div>
                </div>

                <div class="controls-panel">
                    <button class="control-btn" onclick="playPause()">
                        <span id="playIcon">▶️</span> Play
                    </button>
                    <button class="control-btn" onclick="stopVideo()">
                        ⏹️ Stop
                    </button>
                    <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                        <div class="progress-handle" id="progressHandle"></div>
                    </div>
                    <button class="control-btn" onclick="toggleFullscreen()">
                        🔳 Fullscreen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="videoInput" accept="video/mp4,video/webm" multiple style="display: none;">
    <input type="file" id="audioInput" accept="audio/*" multiple style="display: none;">

    <!-- Modals -->
    <div id="trimModal" class="modal">
        <div class="modal-content">
            <h3>Trim Clip</h3>
            <div class="form-group">
                <label>Start Time (seconds):</label>
                <input type="number" id="trimStart" min="0" step="0.1" value="0">
            </div>
            <div class="form-group">
                <label>End Time (seconds):</label>
                <input type="number" id="trimEnd" min="0" step="0.1" value="10">
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeTrimModal()">Cancel</button>
                <button class="control-btn" onclick="applyTrim()">Apply</button>
            </div>
        </div>
    </div>

    <div id="speedModal" class="modal">
        <div class="modal-content">
            <h3>Adjust Speed</h3>
            <div class="form-group">
                <label>Speed Multiplier:</label>
                <select id="speedSelect">
                    <option value="0.25">0.25x (Slow)</option>
                    <option value="0.5">0.5x</option>
                    <option value="1" selected>1x (Normal)</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x (Fast)</option>
                    <option value="4">4x (Very Fast)</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeSpeedModal()">Cancel</button>
                <button class="control-btn" onclick="applySpeed()">Apply</button>
            </div>
        </div>
    </div>

    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h3>Export Video</h3>
            <div class="form-group">
                <label>Quality:</label>
                <select id="exportQuality">
                    <option value="720p">720p HD</option>
                    <option value="1080p" selected>1080p Full HD</option>
                    <option value="4k">4K Ultra HD</option>
                </select>
            </div>
            <div class="form-group">
                <label>Format:</label>
                <select id="exportFormat">
                    <option value="mp4" selected>MP4</option>
                    <option value="webm">WebM</option>
                </select>
            </div>
            <div id="exportProgress" class="hidden">
                <div class="loading">Exporting video...</div>
                <div class="export-progress">
                    <div class="export-progress-fill" id="exportProgressFill"></div>
                </div>
                <div id="exportStatus">Processing: 0%</div>
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button class="control-btn" id="startExportBtn" onclick="startExport()">Start Export</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentVideo = null;
        let videoClips = [];
        let audioClips = [];
        let selectedClip = null;
        let isPlaying = false;
        let currentTime = 0;
        let duration = 0;
        let timelineScale = 1;
        let draggedClip = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupDragAndDrop();
        });

        function setupEventListeners() {
            // File input handlers
            document.getElementById('videoInput').addEventListener('change', handleVideoUpload);
            document.getElementById('audioInput').addEventListener('change', handleAudioUpload);
            
            // Video event listeners
            const video = document.getElementById('mainVideo');
            video.addEventListener('loadedmetadata', onVideoLoaded);
            video.addEventListener('timeupdate', onTimeUpdate);
            video.addEventListener('ended', onVideoEnded);
            
            // Progress bar interaction
            const progressBar = document.getElementById('progressBar');
            progressBar.addEventListener('click', seekVideo);
            
            // Timeline interaction
            document.getElementById('videoTrack').addEventListener('click', onTimelineClick);
            document.getElementById('audioTrack').addEventListener('click', onTimelineClick);
        }

        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFileDrop(e.dataTransfer.files);
            });
            
            uploadArea.addEventListener('click', () => {
                document.getElementById('videoInput').click();
            });
        }

        function handleFileDrop(files) {
            for (let file of files) {
                if (file.type.startsWith('video/')) {
                    loadVideoFile(file);
                } else if (file.type.startsWith('audio/')) {
                    loadAudioFile(file);
                }
            }
        }

        function handleVideoUpload(event) {
            const files = event.target.files;
            for (let file of files) {
                loadVideoFile(file);
            }
        }

        function handleAudioUpload(event) {
            const files = event.target.files;
            for (let file of files) {
                loadAudioFile(file);
            }
        }

        function loadVideoFile(file) {
            const url = URL.createObjectURL(file);
            const video = document.getElementById('mainVideo');
            
            video.src = url;
            currentVideo = {
                file: file,
                url: url,
                name: file.name
            };
            
            // Show video container and hide upload area
            document.getElementById('uploadArea').classList.add('hidden');
            document.getElementById('videoContainer').classList.remove('hidden');
            
            // Add to timeline
            addVideoClipToTimeline(file.name, 0, 0, url);
        }

        function loadAudioFile(file) {
            const url = URL.createObjectURL(file);
            addAudioClipToTimeline(file.name, 0, 0, url);
        }

        function onVideoLoaded() {
            const video = document.getElementById('mainVideo');
            duration = video.duration;
            updateTimeDisplay();
            
            // Update the first video clip duration
            if (videoClips.length > 0) {
                videoClips[0].duration = duration;
                videoClips[0].element.style.width = (duration * timelineScale * 50) + 'px';
                videoClips[0].element.textContent = `${videoClips[0].name} (${formatTime(duration)})`;
            }
        }

        function onTimeUpdate() {
            const video = document.getElementById('mainVideo');
            currentTime = video.currentTime;
            updateTimeDisplay();
            updateProgressBar();
            updateTimelineMarker();
        }

        function onVideoEnded() {
            isPlaying = false;
            document.getElementById('playIcon').textContent = '▶️';
        }

        function addVideoClipToTimeline(name, startTime, duration, url) {
            const clipElement = document.createElement('div');
            clipElement.className = 'video-clip';
            clipElement.style.left = (startTime * timelineScale * 50) + 'px';
            clipElement.style.width = (duration * timelineScale * 50) + 'px';
            clipElement.textContent = `${name} (${formatTime(duration)})`;
            clipElement.addEventListener('click', () => selectClip('video', videoClips.length));
            
            const videoTrack = document.getElementById('videoTrack');
            videoTrack.appendChild(clipElement);
            
            const clip = {
                type: 'video',
                name: name,
                startTime: startTime,
                duration: duration,
                url: url,
                element: clipElement,
                speed: 1,
                volume: 1
            };
            
            videoClips.push(clip);
        }

        function addAudioClipToTimeline(name, startTime, duration, url) {
            const clipElement = document.createElement('div');
            clipElement.className = 'video-clip audio-clip';
            clipElement.style.left = (startTime * timelineScale * 50) + 'px';
            clipElement.style.width = (duration * timelineScale * 50) + 'px';
            clipElement.textContent = `${name} (${formatTime(duration)})`;
            clipElement.addEventListener('click', () => selectClip('audio', audioClips.length));
            
            const audioTrack = document.getElementById('audioTrack');
            audioTrack.appendChild(clipElement);
            
            // Get audio duration
            const audio = new Audio(url);
            audio.addEventListener('loadedmetadata', () => {
                const actualDuration = audio.duration;
                clipElement.style.width = (actualDuration * timelineScale * 50) + 'px';
                clipElement.textContent = `${name} (${formatTime(actualDuration)})`;
                clip.duration = actualDuration;
            });
            
            const clip = {
                type: 'audio',
                name: name,
                startTime: startTime,
                duration: duration,
                url: url,
                element: clipElement,
                volume: 1
            };
            
            audioClips.push(clip);
        }

        function selectClip(type, index) {
            // Remove previous selection
            document.querySelectorAll('.video-clip').forEach(clip => {
                clip.classList.remove('selected');
            });
            
            // Select new clip
            if (type === 'video' && videoClips[index]) {
                selectedClip = videoClips[index];
                selectedClip.element.classList.add('selected');
            } else if (type === 'audio' && audioClips[index]) {
                selectedClip = audioClips[index];
                selectedClip.element.classList.add('selected');
            }
        }

        function playPause() {
            const video = document.getElementById('mainVideo');
            const playIcon = document.getElementById('playIcon');
            
            if (isPlaying) {
                video.pause();
                playIcon.textContent = '▶️';
                isPlaying = false;
            } else {
                video.play();
                playIcon.textContent = '⏸️';
                isPlaying = true;
            }
        }

        function stopVideo() {
            const video = document.getElementById('mainVideo');
            video.pause();
            video.currentTime = 0;
            isPlaying = false;
            document.getElementById('playIcon').textContent = '▶️';
        }

        function seekVideo(event) {
            const progressBar = document.getElementById('progressBar');
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            const video = document.getElementById('mainVideo');
            
            video.currentTime = percentage * duration;
        }

        function updateTimeDisplay() {
            const timeDisplay = document.getElementById('timeDisplay');
            timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        }

        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const progressHandle = document.getElementById('progressHandle');
            const percentage = duration > 0 ? (currentTime / duration) * 100 : 0;
            
            progressFill.style.width = percentage + '%';
            progressHandle.style.left = percentage + '%';
        }

        function updateTimelineMarker() {
            const marker = document.getElementById('timelineMarker');
            const percentage = duration > 0 ? (currentTime / duration) * 100 : 0;
            marker.style.left = percentage + '%';
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function toggleFullscreen() {
            const video = document.getElementById('mainVideo');
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            } else if (video.msRequestFullscreen) {
                video.msRequestFullscreen();
            }
        }

        // Edit functions
        function splitClip() {
            if (!selectedClip) {
                alert('Please select a clip to split');
                return;
            }
            
            const splitTime = currentTime - selectedClip.startTime;
            if (splitTime <= 0 || splitTime >= selectedClip.duration) {
                alert('Split time must be within the clip duration');
                return;
            }
            
            // Create new clip for the second part
            const newClip = {
                ...selectedClip,
                startTime: selectedClip.startTime + splitTime,
                duration: selectedClip.duration - splitTime
            };
            
            // Update original clip
            selectedClip.duration = splitTime;
            
            // Update visual representation
            selectedClip.element.style.width = (selectedClip.duration * timelineScale * 50) + 'px';
            selectedClip.element.textContent = `${selectedClip.name} (${formatTime(selectedClip.duration)})`;
            
            // Add new clip to timeline
            if (selectedClip.type === 'video') {
                addVideoClipToTimeline(newClip.name, newClip.startTime, newClip.duration, newClip.url);
            } else {
                addAudioClipToTimeline(newClip.name, newClip.startTime, newClip.duration, newClip.url);
            }
        }

        function trimClip() {
            if (!selectedClip) {
                alert('Please select a clip to trim');
                return;
            }
            
            document.getElementById('trimStart').value = selectedClip.startTime;
            document.getElementById('trimEnd').value = selectedClip.startTime + selectedClip.duration;
            document.getElementById('trimModal').style.display = 'flex';
        }

        function closeTrimModal() {
            document.getElementById('trimModal').style.display = 'none';
        }

        function applyTrim() {
            const startTime = parseFloat(document.getElementById('trimStart').value);
            const endTime = parseFloat(document.getElementById('trimEnd').value);
            
            if (startTime >= endTime) {
                alert('End time must be greater than start time');
                return;
            }
            
            selectedClip.startTime = startTime;
            selectedClip.duration = endTime - startTime;
            
            // Update visual representation
            selectedClip.element.style.left = (selectedClip.startTime * timelineScale * 50) + 'px';
            selectedClip.element.style.width = (selectedClip.duration * timelineScale * 50) + 'px';
            selectedClip.element.textContent = `${selectedClip.name} (${formatTime(selectedClip.duration)})`;
            
            closeTrimModal();
        }

        function deleteClip() {
            if (!selectedClip) {
                alert('Please select a clip to delete');
                return;
            }
            
            if (confirm('Are you sure you want to delete this clip?')) {
                selectedClip.element.remove();
                
                if (selectedClip.type === 'video') {
                    const index = videoClips.indexOf(selectedClip);
                    if (index > -1) videoClips.splice(index, 1);
                } else {
                    const index = audioClips.indexOf(selectedClip);
                    if (index > -1) audioClips.splice(index, 1);
                }
                
                selectedClip = null;
            }
        }

        function duplicateClip() {
            if (!selectedClip) {
                alert('Please select a clip to duplicate');
                return;
            }
            
            const newStartTime = selectedClip.startTime + selectedClip.duration;
            
            if (selectedClip.type === 'video') {
                addVideoClipToTimeline(selectedClip.name + ' (Copy)', newStartTime, selectedClip.duration, selectedClip.url);
            } else {
                addAudioClipToTimeline(selectedClip.name + ' (Copy)', newStartTime, selectedClip.duration, selectedClip.url);
            }
        }

        function addTransition() {
            if (!selectedClip) {
                alert('Please select a clip to add transition');
                return;
            }
            
            // Add visual indicator for transition
            const transitionElement = document.createElement('div');
            transitionElement.style.position = 'absolute';
            transitionElement.style.right = '-10px';
            transitionElement.style.top = '0';
            transitionElement.style.width = '20px';
            transitionElement.style.height = '100%';
            transitionElement.style.background = 'linear-gradient(90deg, transparent, rgba(255,255,255,0.3))';
            transitionElement.style.borderRadius = '0 4px 4px 0';
            transitionElement.title = 'Fade Transition';
            
            selectedClip.element.appendChild(transitionElement);
            selectedClip.hasTransition = true;
        }

        function adjustSpeed() {
            if (!selectedClip) {
                alert('Please select a clip to adjust speed');
                return;
            }
            
            document.getElementById('speedSelect').value = selectedClip.speed || 1;
            document.getElementById('speedModal').style.display = 'flex';
        }

        function closeSpeedModal() {
            document.getElementById('speedModal').style.display = 'none';
        }

        function applySpeed() {
            const speed = parseFloat(document.getElementById('speedSelect').value);
            selectedClip.speed = speed;
            
            // Update visual representation
            const newDuration = selectedClip.duration / speed;
            selectedClip.element.style.width = (newDuration * timelineScale * 50) + 'px';
            
            // Add speed indicator
            let speedIndicator = selectedClip.element.querySelector('.speed-indicator');
            if (!speedIndicator) {
                speedIndicator = document.createElement('div');
                speedIndicator.className = 'speed-indicator';
                speedIndicator.style.position = 'absolute';
                speedIndicator.style.top = '2px';
                speedIndicator.style.right = '2px';
                speedIndicator.style.background = 'rgba(0,0,0,0.7)';
                speedIndicator.style.color = 'white';
                speedIndicator.style.fontSize = '10px';
                speedIndicator.style.padding = '2px 4px';
                speedIndicator.style.borderRadius = '2px';
                selectedClip.element.appendChild(speedIndicator);
            }
            speedIndicator.textContent = speed + 'x';
            
            closeSpeedModal();
        }

        function addFilter() {
            if (!selectedClip) {
                alert('Please select a clip to add filter');
                return;
            }
            
            const filters = ['Brightness', 'Contrast', 'Saturation', 'Blur', 'Sepia', 'Grayscale'];
            const selectedFilter = prompt('Choose a filter:\n' + filters.join('\n'));
            
            if (selectedFilter && filters.includes(selectedFilter)) {
                // Add filter indicator
                let filterIndicator = selectedClip.element.querySelector('.filter-indicator');
                if (!filterIndicator) {
                    filterIndicator = document.createElement('div');
                    filterIndicator.className = 'filter-indicator';
                    filterIndicator.style.position = 'absolute';
                    filterIndicator.style.top = '2px';
                    filterIndicator.style.left = '2px';
                    filterIndicator.style.background = 'rgba(0,0,0,0.7)';
                    filterIndicator.style.color = 'white';
                    filterIndicator.style.fontSize = '10px';
                    filterIndicator.style.padding = '2px 4px';
                    filterIndicator.style.borderRadius = '2px';
                    selectedClip.element.appendChild(filterIndicator);
                }
                filterIndicator.textContent = '🎭 ' + selectedFilter;
                selectedClip.filter = selectedFilter;
            }
        }

        function adjustVolume() {
            if (!selectedClip) {
                alert('Please select a clip to adjust volume');
                return;
            }
            
            const volume = prompt('Enter volume level (0.0 to 2.0):', selectedClip.volume || 1);
            if (volume !== null) {
                const volumeValue = parseFloat(volume);
                if (volumeValue >= 0 && volumeValue <= 2) {
                    selectedClip.volume = volumeValue;
                    
                    // Add volume indicator
                    let volumeIndicator = selectedClip.element.querySelector('.volume-indicator');
                    if (!volumeIndicator) {
                        volumeIndicator = document.createElement('div');
                        volumeIndicator.className = 'volume-indicator';
                        volumeIndicator.style.position = 'absolute';
                        volumeIndicator.style.bottom = '2px';
                        volumeIndicator.style.right = '2px';
                        volumeIndicator.style.background = 'rgba(0,0,0,0.7)';
                        volumeIndicator.style.color = 'white';
                        volumeIndicator.style.fontSize = '10px';
                        volumeIndicator.style.padding = '2px 4px';
                        volumeIndicator.style.borderRadius = '2px';
                        selectedClip.element.appendChild(volumeIndicator);
                    }
                    volumeIndicator.textContent = '🔊 ' + Math.round(volumeValue * 100) + '%';
                } else {
                    alert('Volume must be between 0.0 and 2.0');
                }
            }
        }

        function fadeAudio() {
            if (!selectedClip) {
                alert('Please select a clip to add fade');
                return;
            }
            
            const fadeType = prompt('Choose fade type:\nfade-in\nfade-out\nfade-in-out');
            if (['fade-in', 'fade-out', 'fade-in-out'].includes(fadeType)) {
                selectedClip.fadeType = fadeType;
                
                // Add fade indicator
                let fadeIndicator = selectedClip.element.querySelector('.fade-indicator');
                if (!fadeIndicator) {
                    fadeIndicator = document.createElement('div');
                    fadeIndicator.className = 'fade-indicator';
                    fadeIndicator.style.position = 'absolute';
                    fadeIndicator.style.bottom = '2px';
                    fadeIndicator.style.left = '2px';
                    fadeIndicator.style.background = 'rgba(0,0,0,0.7)';
                    fadeIndicator.style.color = 'white';
                    fadeIndicator.style.fontSize = '10px';
                    fadeIndicator.style.padding = '2px 4px';
                    fadeIndicator.style.borderRadius = '2px';
                    selectedClip.element.appendChild(fadeIndicator);
                }
                fadeIndicator.textContent = '📉 ' + fadeType;
            }
        }

        function muteTrack() {
            if (!selectedClip) {
                alert('Please select a clip to mute');
                return;
            }
            
            selectedClip.muted = !selectedClip.muted;
            
            if (selectedClip.muted) {
                selectedClip.element.style.opacity = '0.5';
                selectedClip.element.style.filter = 'grayscale(100%)';
                
                // Add mute indicator
                let muteIndicator = selectedClip.element.querySelector('.mute-indicator');
                if (!muteIndicator) {
                    muteIndicator = document.createElement('div');
                    muteIndicator.className = 'mute-indicator';
                    muteIndicator.style.position = 'absolute';
                    muteIndicator.style.top = '50%';
                    muteIndicator.style.left = '50%';
                    muteIndicator.style.transform = 'translate(-50%, -50%)';
                    muteIndicator.style.background = 'rgba(255,0,0,0.8)';
                    muteIndicator.style.color = 'white';
                    muteIndicator.style.fontSize = '12px';
                    muteIndicator.style.padding = '4px 8px';
                    muteIndicator.style.borderRadius = '4px';
                    muteIndicator.style.fontWeight = 'bold';
                    selectedClip.element.appendChild(muteIndicator);
                }
                muteIndicator.textContent = '🔇 MUTED';
            } else {
                selectedClip.element.style.opacity = '1';
                selectedClip.element.style.filter = 'none';
                const muteIndicator = selectedClip.element.querySelector('.mute-indicator');
                if (muteIndicator) muteIndicator.remove();
            }
        }

        function exportVideo() {
            if (videoClips.length === 0) {
                alert('No video clips to export');
                return;
            }
            
            document.getElementById('exportModal').style.display = 'flex';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
            document.getElementById('exportProgress').classList.add('hidden');
            document.getElementById('startExportBtn').style.display = 'block';
        }

        function startExport() {
            const quality = document.getElementById('exportQuality').value;
            const format = document.getElementById('exportFormat').value;
            
            document.getElementById('exportProgress').classList.remove('hidden');
            document.getElementById('startExportBtn').style.display = 'none';
            
            // Simulate export progress
            let progress = 0;
            const exportInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(exportInterval);
                    
                    // Create download link
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = currentVideo.url;
                        link.download = `edited_video_${Date.now()}.${format}`;
                        link.click();
                        
                        alert('Export completed! Video downloaded.');
                        closeExportModal();
                    }, 1000);
                }
                
                document.getElementById('exportProgressFill').style.width = progress + '%';
                document.getElementById('exportStatus').textContent = `Processing: ${Math.round(progress)}%`;
            }, 200);
        }

        function saveProject() {
            const projectData = {
                videoClips: videoClips.map(clip => ({
                    name: clip.name,
                    startTime: clip.startTime,
                    duration: clip.duration,
                    speed: clip.speed,
                    volume: clip.volume,
                    filter: clip.filter,
                    fadeType: clip.fadeType,
                    muted: clip.muted,
                    hasTransition: clip.hasTransition
                })),
                audioClips: audioClips.map(clip => ({
                    name: clip.name,
                    startTime: clip.startTime,
                    duration: clip.duration,
                    volume: clip.volume,
                    fadeType: clip.fadeType,
                    muted: clip.muted
                })),
                timeline: {
                    scale: timelineScale,
                    duration: duration
                }
            };
            
            const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `video_project_${Date.now()}.json`;
            link.click();
            
            alert('Project saved successfully!');
        }

        function onTimelineClick(event) {
            // Handle timeline click for scrubbing
            const rect = event.currentTarget.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const timelineWidth = rect.width;
            const clickTime = (clickX / timelineWidth) * duration;
            
            const video = document.getElementById('mainVideo');
            video.currentTime = clickTime;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName === 'INPUT') return;
            
            switch(event.key) {
                case ' ':
                    event.preventDefault();
                    playPause();
                    break;
                case 'Delete':
                case 'Backspace':
                    if (selectedClip) {
                        event.preventDefault();
                        deleteClip();
                    }
                    break;
                case 's':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        saveProject();
                    }
                    break;
                case 'c':
                    if (event.ctrlKey || event.metaKey && selectedClip) {
                        event.preventDefault();
                        duplicateClip();
                    }
                    break;
            }
        });

        // Auto-save functionality
        setInterval(() => {
            if (videoClips.length > 0 || audioClips.length > 0) {
                localStorage.setItem('videoEditor_autosave', JSON.stringify({
                    timestamp: Date.now(),
                    videoClips: videoClips.length,
                    audioClips: audioClips.length
                }));
            }
        }, 30000); // Auto-save every 30 seconds

        // Load autosave on startup
        window.addEventListener('load', () => {
            const autosave = localStorage.getItem('videoEditor_autosave');
            if (autosave) {
                const data = JSON.parse(autosave);
                if (Date.now() - data.timestamp < 3600000) { // Within 1 hour
                    if (confirm('Found recent autosave data. Would you like to restore your previous session?')) {
                        // Restore logic would go here
                        console.log('Restoring autosave...', data);
                    }
                }
            }
        });
    </script>
</body>
</html>